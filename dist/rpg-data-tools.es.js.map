{"version":3,"file":"rpg-data-tools.es.js","sources":["../src/constructData/mainData.ts","../src/constructData/map.ts","../src/constructData/audio/createAudio.ts","../src/constructData/systemData.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/commandCheck.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/errors/errorConstants.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/pickCommands.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/commandComment.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/commandScript.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/commandMessage.ts","../src/eventCommand/commandMapper/commandGroup/pickCommands/commandScrollText.ts","../src/eventCommand/commandMapper/commandGroup/class/join.ts","../src/eventCommand/commandMapper/commandGroup/class/commandGroop.ts","../src/eventCommand/commandMapper/commandGroup/class/commentUtils.ts","../src/eventCommand/commandMapper/commandGroup/class/createGroup.ts","../src/eventCommand/commandMapper/commandGroup/handleGroupGommnads.ts","../src/eventCommand/commandMapper/text.ts","../src/eventCommand/commandMapper/allMapping.ts","../src/eventCommand/commandMapper/groupMerge.ts","../src/eventCommand/rpg/map/eventProcessor.ts","../src/eventCommand/rpg/replaceCommands.ts","../src/eventCommand/normalize.ts","../src/eventCommand/utils/matches/matchesEventCommand.ts","../src/eventCommand/utils/pickParam/pickCommandParam.ts","../src/eventCommand/variable/variableDesignation/piravate/privateConstants.ts","../src/eventCommand/variable/variableDesignation/variableDesignation.ts","../src/eventCommand/variable/params.ts","../src/format/note/note.ts","../src/format/codeInfoText.ts","../src/format/controlChars/constants.ts","../src/format/controlChars/controlChars.ts","../src/format/controlChars/getContolChars.ts","../src/utils/dataPicker/pickPropety.ts"],"sourcesContent":["import type {\r\n  Data_Actor,\r\n  Data_Enemy,\r\n  Data_Weapon,\r\n  Data_Armor,\r\n  Data_Class,\r\n  Data_Skill,\r\n  Data_Item,\r\n  Data_State,\r\n  ParamArray,\r\n} from \"@sigureya/rpgtypes\";\r\n\r\nexport const constructParamArray = (): ParamArray => {\r\n  return [0, 0, 0, 0, 0, 0, 0, 0];\r\n};\r\n\r\nexport const constructActor = (proto?: Partial<Data_Actor>): Data_Actor => {\r\n  return {\r\n    id: 0,\r\n    name: \"\",\r\n    nickname: \"\",\r\n    profile: \"\",\r\n    note: \"\",\r\n    classId: 0,\r\n    initialLevel: 1,\r\n    maxLevel: 99,\r\n    characterIndex: 0,\r\n    characterName: \"\",\r\n    faceIndex: 0,\r\n    faceName: \"\",\r\n    battlerName: \"\",\r\n    traits: [],\r\n    equips: [],\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructEnemy = (proto?: Partial<Data_Enemy>): Data_Enemy => {\r\n  return {\r\n    battlerHue: 0,\r\n    id: 0,\r\n    name: \"\",\r\n    note: \"\",\r\n    battlerName: \"\",\r\n    traits: [],\r\n    params: constructParamArray(),\r\n    exp: 0,\r\n    gold: 0,\r\n    dropItems: [],\r\n    actions: [],\r\n\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructArmor = (proto?: Partial<Data_Armor>): Data_Armor => {\r\n  return {\r\n    price: 0,\r\n    id: 0,\r\n    name: \"\",\r\n    note: \"\",\r\n    iconIndex: 0,\r\n    description: \"\",\r\n    etypeId: 0,\r\n    params: constructParamArray(),\r\n    traits: [],\r\n\r\n    ...proto,\r\n  };\r\n};\r\nexport const constructWeapon = (proto?: Partial<Data_Weapon>): Data_Weapon => {\r\n  return {\r\n    price: 0,\r\n    id: 0,\r\n    name: \"\",\r\n    note: \"\",\r\n    iconIndex: 0,\r\n    description: \"\",\r\n    etypeId: 0,\r\n    wtypeId: 0,\r\n    params: constructParamArray(),\r\n    traits: [],\r\n    damage: constructDamage(),\r\n\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructClass = (proto?: Partial<Data_Class>): Data_Class => {\r\n  return {\r\n    id: 0,\r\n    name: \"\",\r\n    note: \"\",\r\n    traits: [],\r\n    learnings: [],\r\n    params: constructParamArray(),\r\n    expParams: [],\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructDamage = (\r\n  proto?: Partial<Data_Skill[\"damage\"]>\r\n): Data_Skill[\"damage\"] => {\r\n  return {\r\n    type: 0,\r\n    elementId: 0,\r\n    formula: \"0\",\r\n    variance: 20,\r\n    critical: false,\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructItem = (proto?: Partial<Data_Item>): Data_Item => {\r\n  return {\r\n    id: 0,\r\n    name: \"\",\r\n    iconIndex: 0,\r\n    description: \"\",\r\n    note: \"\",\r\n    price: 0,\r\n    consumable: false,\r\n    scope: 0,\r\n    occasion: 0,\r\n    speed: 0,\r\n    successRate: 100,\r\n    repeats: 1,\r\n    tpGain: 0,\r\n    hitType: 0,\r\n    animationId: 0,\r\n    damage: constructDamage(),\r\n    effects: [],\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructSkill = (proto?: Partial<Data_Skill>): Data_Skill => {\r\n  return {\r\n    animationId: 0,\r\n    damage: constructDamage(),\r\n    description: \"\",\r\n    hitType: 0,\r\n    iconIndex: 0,\r\n    id: 0,\r\n    message1: \"\",\r\n    message2: \"\",\r\n    mpCost: 0,\r\n    name: \"\",\r\n    note: \"\",\r\n    occasion: 0,\r\n    repeats: 1,\r\n    requiredWtypeId1: 0,\r\n    requiredWtypeId2: 0,\r\n    scope: 0,\r\n    speed: 0,\r\n    stypeId: 0,\r\n    successRate: 100,\r\n    tpCost: 0,\r\n    tpGain: 0,\r\n    effects: [],\r\n    messageType: 0,\r\n\r\n    ...proto,\r\n  };\r\n};\r\n\r\nexport const constructState = (proto?: Partial<Data_State>): Data_State => {\r\n  return {\r\n    id: 0,\r\n    name: \"\",\r\n    iconIndex: 0,\r\n    restriction: 0,\r\n    priority: 50,\r\n    motion: 0,\r\n    overlay: 0,\r\n    removeAtBattleEnd: false,\r\n    removeByRestriction: false,\r\n    autoRemovalTiming: 0,\r\n    minTurns: 1,\r\n    maxTurns: 1,\r\n    removeByDamage: false,\r\n    chanceByDamage: 100,\r\n    removeByWalking: false,\r\n    stepsToRemove: 100,\r\n    message1: \"\",\r\n    message2: \"\",\r\n    message3: \"\",\r\n    message4: \"\",\r\n    traits: [],\r\n    note: \"\",\r\n    ...proto,\r\n  };\r\n};\r\n","import type { Data_Map, MapEvent } from \"@sigureya/rpgtypes\";\r\nimport type { MapEventPage } from \"@sigureya/rpgtypes\";\r\n\r\nexport const createMap = (\r\n  proto: {\r\n    bgm: Data_Map[\"bgm\"];\r\n    bgs: Data_Map[\"bgs\"];\r\n  } & Partial<Data_Map>\r\n): Data_Map => ({\r\n  autoplayBgm: true,\r\n  autoplayBgs: false,\r\n  battleback1Name: \"\",\r\n  battleback2Name: \"\",\r\n  data: [],\r\n  disableDashing: false,\r\n  displayName: \"\",\r\n  encounterList: [],\r\n  events: [],\r\n  height: 0,\r\n  note: \"\",\r\n  width: 0,\r\n  x: 0,\r\n  y: 0,\r\n  parallaxName: \"\",\r\n  parallaxLoopX: false,\r\n  parallaxLoopY: false,\r\n  parallaxShow: false,\r\n  parallaxSx: 0,\r\n  parallaxSy: 0,\r\n  ...proto,\r\n});\r\n\r\nexport const createMapEvent = (arg?: Partial<MapEvent>): MapEvent => ({\r\n  id: 0,\r\n  name: \"\",\r\n  note: \"\",\r\n  x: 0,\r\n  y: 0,\r\n  pages: [createEventPage()],\r\n  ...arg,\r\n});\r\n\r\nexport const createCondtion = (\r\n  arg?: Partial<MapEventPage[\"conditions\"]>\r\n): MapEventPage[\"conditions\"] => ({\r\n  actorId: 0,\r\n  actorValid: false,\r\n  itemId: 0,\r\n  itemValid: false,\r\n  selfSwitchCh: \"\",\r\n  selfSwitchValid: false,\r\n  switch1Id: 0,\r\n  switch1Valid: false,\r\n  switch2Id: 0,\r\n  switch2Valid: false,\r\n  variableId: 0,\r\n  variableValid: false,\r\n  variableValue: 0,\r\n  ...arg,\r\n});\r\n\r\nexport const createMapEventImage = (\r\n  arg?: Partial<MapEventPage[\"image\"]>\r\n): MapEventPage[\"image\"] => ({\r\n  characterIndex: 0,\r\n  characterName: \"\",\r\n  direction: 6,\r\n  pattern: 0,\r\n  tileId: 0,\r\n  ...arg,\r\n});\r\n\r\nexport const createEventPage = (arg?: Partial<MapEventPage>): MapEventPage => ({\r\n  conditions: createCondtion(),\r\n  image: createMapEventImage(),\r\n  moveRoute: {\r\n    list: [],\r\n    repeat: false,\r\n    wait: false,\r\n    skippable: false,\r\n  },\r\n  directionFix: false,\r\n  moveFrequency: 0,\r\n  list: [],\r\n  ...arg,\r\n});\r\n","import type {\r\n  AudioFileParams,\r\n  ExtractCommandByParam,\r\n} from \"@sigureya/rpgtypes\";\r\n\r\nexport const createAudio = (\r\n  audio: Partial<AudioFileParams> = {}\r\n): AudioFileParams => {\r\n  return {\r\n    name: audio.name ?? \"\",\r\n    volume: audio.volume ?? 90,\r\n    pitch: audio.pitch ?? 100,\r\n    pan: audio.pan ?? 0,\r\n  };\r\n};\r\n\r\nexport const createAudioCommand = <\r\n  Code extends ExtractCommandByParam<[AudioFileParams]>[\"code\"]\r\n>(\r\n  code: Code,\r\n  name: string,\r\n  indent = 0\r\n) => {\r\n  return {\r\n    code,\r\n    parameters: [createAudio({ name })] as [AudioFileParams],\r\n    indent,\r\n  };\r\n};\r\n","import type {\r\n  Data_System,\r\n  Terms_Messages,\r\n  System_Terms,\r\n  System_Advanced,\r\n  Data_Vehicle,\r\n  Terms_BasicArray,\r\n  Terms_ParamNamesArray,\r\n  Terms_CommandArray,\r\n  System_SoundsArray,\r\n} from \"@sigureya/rpgtypes\";\r\nimport type { SystemSounds } from \"./audio\";\r\nimport { createAudio } from \"./audio\";\r\nimport type { ParamTable } from \"./paramArray\";\r\nimport type { Terms_Commands, BasicTerms } from \"./types\";\r\n\r\nexport const createSystemData = (\r\n  system: Partial<Data_System> = {}\r\n): Data_System => ({\r\n  local: system.local ?? \"\",\r\n  gameTitle: system.gameTitle ?? \"\",\r\n  currencyUnit: system.currencyUnit ?? \"\",\r\n  title1Name: system.title1Name ?? \"\",\r\n  terms: system.terms ?? createTerms(),\r\n  title2Name: system.title2Name ?? \"\",\r\n  optAutosave: system.optAutosave ?? false,\r\n  attackMotions: system.attackMotions ?? [],\r\n  startMapId: system.startMapId ?? 0,\r\n  startX: system.startX ?? 0,\r\n  startY: system.startY ?? 0,\r\n  switches: system.switches ?? [],\r\n  windowTone: system.windowTone ?? [0, 0, 0, 0],\r\n  editMapId: system.editMapId ?? 0,\r\n  testTroopId: system.testTroopId ?? 0,\r\n  testBattlers: system.testBattlers ?? [],\r\n  versionId: system.versionId ?? 0,\r\n  advanced: system.advanced ?? createAdvanced(),\r\n  armorTypes: system.armorTypes ?? [],\r\n  elements: system.elements ?? [],\r\n  variables: system.variables ?? [],\r\n  equipTypes: system.equipTypes ?? [],\r\n  sounds: system.sounds ?? createSystemSoundsArray(),\r\n  titleBgm: system.titleBgm ?? createAudio(),\r\n  gameoverMe: system.gameoverMe ?? createAudio(),\r\n  battleBgm: system.battleBgm ?? createAudio(),\r\n  defeatMe: system.defeatMe ?? createAudio(),\r\n  victoryMe: system.victoryMe ?? createAudio(),\r\n  battleback1Name: system.battleback1Name ?? \"\",\r\n  battleback2Name: system.battleback2Name ?? \"\",\r\n  battlerName: system.battlerName ?? \"\",\r\n  weaponTypes: system.weaponTypes ?? [],\r\n  skillTypes: system.skillTypes ?? [],\r\n  optDisplayTp: system.optDisplayTp ?? false,\r\n  optDrawTitle: system.optDrawTitle ?? false,\r\n  optExtraExp: system.optExtraExp ?? false,\r\n  optFloorDeath: system.optFloorDeath ?? false,\r\n  optFollowers: system.optFollowers ?? false,\r\n  optKeyItemsNumber: system.optKeyItemsNumber ?? false,\r\n  optSideView: system.optSideView ?? false,\r\n  optSlipDeath: system.optSlipDeath ?? false,\r\n  optTransparent: system.optTransparent ?? false,\r\n  boat: system.boat ?? createVehicle(),\r\n  ship: system.ship ?? createVehicle(),\r\n  airship: system.airship ?? createVehicle(),\r\n  tileSize: system.tileSize ?? 0,\r\n});\r\n\r\nexport const createTerms = (\r\n  proto: {\r\n    messages?: Partial<Terms_Messages>;\r\n    commands?: Partial<Terms_Commands>;\r\n    params?: Partial<ParamTable<string>>;\r\n    basic?: Partial<BasicTerms>;\r\n  } = {}\r\n): System_Terms => ({\r\n  messages: createMessages(proto.messages ?? {}),\r\n  commands: createCommandsArray(proto.commands ?? {}),\r\n  params: createParamNamesArray(proto.params ?? {}),\r\n  basic: createBasicTerms(proto.basic ?? {}),\r\n});\r\n\r\nexport const createBasicTerms = (\r\n  proto: Partial<BasicTerms> = {}\r\n): Terms_BasicArray => [\r\n  proto.level ?? \"\",\r\n  proto.levelA ?? \"\",\r\n  proto.hp ?? \"\",\r\n  proto.hpA ?? \"\",\r\n  proto.mp ?? \"\",\r\n  proto.mpA ?? \"\",\r\n  proto.tp ?? \"\",\r\n  proto.tpA ?? \"\",\r\n  proto.experience ?? \"\",\r\n  proto.exp ?? \"\",\r\n];\r\n\r\nexport const createParamNamesArray = (\r\n  names: Partial<ParamTable<string>> = {}\r\n): Terms_ParamNamesArray => [\r\n  names.mhp ?? \"\",\r\n  names.mmp ?? \"\",\r\n  names.atk ?? \"\",\r\n  names.def ?? \"\",\r\n  names.mat ?? \"\",\r\n  names.mdf ?? \"\",\r\n  names.agi ?? \"\",\r\n  names.luk ?? \"\",\r\n  names.hit ?? \"\",\r\n  names.eva ?? \"\",\r\n];\r\n\r\nexport const createCommandsArray = (\r\n  proto: Partial<Terms_Commands> = {}\r\n): Terms_CommandArray => [\r\n  proto.fight ?? \"\",\r\n  proto.escape ?? \"\",\r\n  proto.attack ?? \"\",\r\n  proto.guard ?? \"\",\r\n  proto.item ?? \"\",\r\n  proto.skill ?? \"\",\r\n  proto.equip ?? \"\",\r\n  proto.status ?? \"\",\r\n  proto.formation ?? \"\",\r\n  proto.save ?? \"\",\r\n  proto.gameEnd ?? \"\",\r\n  proto.options ?? \"\",\r\n  proto.weapon ?? \"\",\r\n  proto.armor ?? \"\",\r\n  proto.keyItem ?? \"\",\r\n  proto.equip2 ?? \"\",\r\n  proto.optimize ?? \"\",\r\n  proto.clear ?? \"\",\r\n  proto.newGame ?? \"\",\r\n  proto.continue_ ?? \"\",\r\n  proto.notUsed20 ?? \"\",\r\n  proto.toTitle ?? \"\",\r\n  proto.cancel ?? \"\",\r\n  proto.notUsed23 ?? \"\",\r\n  proto.buy ?? \"\",\r\n  proto.sell ?? \"\",\r\n];\r\n\r\nexport const createMessages = (\r\n  proto: Partial<Terms_Messages> = {}\r\n): Terms_Messages => ({\r\n  alwaysDash: proto.alwaysDash ?? \"\",\r\n  commandRemember: proto.commandRemember ?? \"\",\r\n  touchUI: proto.touchUI ?? \"\",\r\n  bgmVolume: proto.bgmVolume ?? \"\",\r\n  bgsVolume: proto.bgsVolume ?? \"\",\r\n  meVolume: proto.meVolume ?? \"\",\r\n  seVolume: proto.seVolume ?? \"\",\r\n  possession: proto.possession ?? \"\",\r\n  expTotal: proto.expTotal ?? \"\",\r\n  expNext: proto.expNext ?? \"\",\r\n  saveMessage: proto.saveMessage ?? \"\",\r\n  loadMessage: proto.loadMessage ?? \"\",\r\n  file: proto.file ?? \"\",\r\n  autosave: proto.autosave ?? \"\",\r\n  partyName: proto.partyName ?? \"\",\r\n  emerge: proto.emerge ?? \"\",\r\n  preemptive: proto.preemptive ?? \"\",\r\n  surprise: proto.surprise ?? \"\",\r\n  escapeStart: proto.escapeStart ?? \"\",\r\n  escapeFailure: proto.escapeFailure ?? \"\",\r\n  victory: proto.victory ?? \"\",\r\n  defeat: proto.defeat ?? \"\",\r\n  obtainExp: proto.obtainExp ?? \"\",\r\n  obtainGold: proto.obtainGold ?? \"\",\r\n  obtainItem: proto.obtainItem ?? \"\",\r\n  levelUp: proto.levelUp ?? \"\",\r\n  obtainSkill: proto.obtainSkill ?? \"\",\r\n  useItem: proto.useItem ?? \"\",\r\n  criticalToEnemy: proto.criticalToEnemy ?? \"\",\r\n  criticalToActor: proto.criticalToActor ?? \"\",\r\n  actorDamage: proto.actorDamage ?? \"\",\r\n  actorRecovery: proto.actorRecovery ?? \"\",\r\n  actorGain: proto.actorGain ?? \"\",\r\n  actorLoss: proto.actorLoss ?? \"\",\r\n  actorDrain: proto.actorDrain ?? \"\",\r\n  actorNoDamage: proto.actorNoDamage ?? \"\",\r\n  actorNoHit: proto.actorNoHit ?? \"\",\r\n  enemyDamage: proto.enemyDamage ?? \"\",\r\n  enemyRecovery: proto.enemyRecovery ?? \"\",\r\n  enemyGain: proto.enemyGain ?? \"\",\r\n  enemyLoss: proto.enemyLoss ?? \"\",\r\n  enemyDrain: proto.enemyDrain ?? \"\",\r\n  enemyNoDamage: proto.enemyNoDamage ?? \"\",\r\n  enemyNoHit: proto.enemyNoHit ?? \"\",\r\n  evasion: proto.evasion ?? \"\",\r\n  magicEvasion: proto.magicEvasion ?? \"\",\r\n  magicReflection: proto.magicReflection ?? \"\",\r\n  counterAttack: proto.counterAttack ?? \"\",\r\n  substitute: proto.substitute ?? \"\",\r\n  buffAdd: proto.buffAdd ?? \"\",\r\n  debuffAdd: proto.debuffAdd ?? \"\",\r\n  buffRemove: proto.buffRemove ?? \"\",\r\n  actionFailure: proto.actionFailure ?? \"\",\r\n});\r\nexport const createAdvanced = (\r\n  proto: Partial<System_Advanced> = {}\r\n): System_Advanced => ({\r\n  gameId: proto.gameId ?? 0,\r\n  screenWidth: proto.screenWidth ?? 0,\r\n  screenHeight: proto.screenHeight ?? 0,\r\n  uiAreaWidth: proto.uiAreaWidth ?? 0,\r\n  uiAreaHeight: proto.uiAreaHeight ?? 0,\r\n  windowOpacity: proto.windowOpacity ?? 0,\r\n  screenScale: proto.screenScale ?? 0,\r\n  numberFontFilename: proto.numberFontFilename ?? \"\",\r\n  mainFontFilename: proto.mainFontFilename ?? \"\",\r\n  fallbackFonts: proto.fallbackFonts ?? \"\",\r\n  fontSize: proto.fontSize ?? 0,\r\n});\r\n\r\nexport const createVehicle = (\r\n  proto: Partial<Data_Vehicle> = {}\r\n): Data_Vehicle => ({\r\n  bgm: proto.bgm ?? createAudio(),\r\n  characterIndex: proto.characterIndex ?? 0,\r\n  characterName: proto.characterName ?? \"\",\r\n  startMapId: proto.startMapId ?? 0,\r\n  startX: proto.startX ?? 0,\r\n  startY: proto.startY ?? 0,\r\n});\r\n\r\nexport const createSystemSoundsArray = (\r\n  proto: Partial<SystemSounds> = {}\r\n): System_SoundsArray => [\r\n  proto.cursor ?? createAudio(),\r\n  proto.ok ?? createAudio(),\r\n  proto.cancel ?? createAudio(),\r\n  proto.buzzer ?? createAudio(),\r\n  proto.equip ?? createAudio(),\r\n  proto.save ?? createAudio(),\r\n  proto.load ?? createAudio(),\r\n  proto.battleStart ?? createAudio(),\r\n  proto.escape ?? createAudio(),\r\n  proto.enemyAttack ?? createAudio(),\r\n  proto.enemyDamage ?? createAudio(),\r\n  proto.enemyCollapse ?? createAudio(),\r\n  proto.bossCollapse1 ?? createAudio(),\r\n  proto.bossCollapse2 ?? createAudio(),\r\n  proto.actorDamage ?? createAudio(),\r\n  proto.actorCollapse ?? createAudio(),\r\n  proto.playRecovery ?? createAudio(),\r\n  proto.playMiss ?? createAudio(),\r\n  proto.playEvasion ?? createAudio(),\r\n  proto.playMagicEvasion ?? createAudio(),\r\n  proto.playReflection ?? createAudio(),\r\n  proto.shop ?? createAudio(),\r\n  proto.useItem ?? createAudio(),\r\n  proto.useSkill ?? createAudio(),\r\n];\r\n","import type { EventCode, EventCommandLike } from \"@sigureya/rpgtypes\";\r\n\r\nexport const codeTest = <Code extends EventCode>(\r\n  code: Code,\r\n  command: EventCommandLike | undefined\r\n): command is EventCommandLike<Code> => {\r\n  if (!command) {\r\n    return false;\r\n  }\r\n  return code === command.code;\r\n};\r\n","export const ERROR_COMMAND_MESSAGE = \"MessageHeader invalid command\" as const;\r\nexport const ERROR_COMMAND_SCRIPT = \"Script invalid command\" as const;\r\nexport const ERROR_INVALID_HEAD = \"Invalid Head\" as const;\r\n","import type {\r\n  EventCommandLike,\r\n  EventCode,\r\n  EventCommand,\r\n  ExtractCommandByParam,\r\n} from \"@sigureya/rpgtypes\";\r\n\r\nimport type * as RpgTypes from \"@sigureya/rpgtypes\";\r\nimport { codeTest } from \"./commandCheck\";\r\nimport { ERROR_INVALID_HEAD } from \"./errors/\";\r\n\r\nexport const isBodyParams = (\r\n  param: unknown[]\r\n): param is [string] & { length: 1 } => {\r\n  return typeof param[0] === \"string\" && param.length === 1;\r\n};\r\n\r\nexport const isHeadCommand = <Code extends EventCode>(\r\n  code: Code,\r\n  command: EventCommandLike | undefined\r\n): command is {\r\n  code: Code;\r\n  indent: number;\r\n  parameters: [string];\r\n} => {\r\n  if (!command) {\r\n    return false;\r\n  }\r\n  return code === command.code && isBodyParams(command.parameters);\r\n};\r\n\r\nexport const pickCommands = <Code extends EventCode>(\r\n  code: Code,\r\n  arrya: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): Array<{\r\n  code: Code;\r\n  indent: number;\r\n  parameters: [string];\r\n}> => {\r\n  const result: {\r\n    code: Code;\r\n    indent: number;\r\n    parameters: [string];\r\n  }[] = [];\r\n  for (let i = start; i < arrya.length; i++) {\r\n    const command = arrya[i];\r\n    if (codeTest(code, command) && isBodyParams(command.parameters)) {\r\n      result.push({\r\n        code: code,\r\n        indent: command.indent,\r\n        parameters: [command.parameters[0]],\r\n      });\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nexport const pickHead = <Code extends ExtractCommandByParam<[string]>[\"code\"]>(\r\n  commands: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  code: Code\r\n): {\r\n  code: Code;\r\n  indent: number;\r\n  parameters: [string];\r\n} => {\r\n  const head = commands[index];\r\n  if (head) {\r\n    if (codeTest(code, head) && isBodyParams(head.parameters)) {\r\n      return {\r\n        code: code,\r\n        indent: head.indent,\r\n        parameters: [head.parameters[0]],\r\n      };\r\n    }\r\n  }\r\n  throw new Error(ERROR_INVALID_HEAD, { cause: head });\r\n};\r\n","import type {\r\n  EventCommand,\r\n  Command_Comment,\r\n  Command_CommentBody,\r\n} from \"@sigureya/rpgtypes\";\r\nimport { COMMENT, COMMENT_BODY } from \"@sigureya/rpgtypes\";\r\nimport { pickHead, pickCommands } from \"./pickCommands\";\r\nimport type { EventCommandPair } from \"./pairTypes\";\r\n\r\nexport const pickComments = (\r\n  array: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): EventCommandPair<Command_Comment, Command_CommentBody> => {\r\n  const head = pickHead(array, start, COMMENT);\r\n\r\n  return {\r\n    head: head,\r\n    bodys: pickCommands(COMMENT_BODY, array, start + 1),\r\n  };\r\n};\r\n","import type {\r\n  EventCommand,\r\n  Command_ScriptHeader,\r\n  Command_ScriptBody,\r\n} from \"@sigureya/rpgtypes\";\r\nimport { SCRIPT_EVAL, SCRIPT_EVAL_BODY } from \"@sigureya/rpgtypes\";\r\nimport { pickCommands, pickHead } from \"./pickCommands\";\r\nimport type { EventCommandPair } from \"./pairTypes\";\r\n\r\nexport const pickScripts = (\r\n  arrya: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): EventCommandPair<Command_ScriptHeader, Command_ScriptBody> => {\r\n  const head = pickHead(arrya, start, SCRIPT_EVAL);\r\n  return {\r\n    head: head,\r\n    bodys: pickCommands(SCRIPT_EVAL_BODY, arrya, start + 1),\r\n  };\r\n};\r\n","import type {\r\n  Command_ShowMessage,\r\n  Command_ShowMessageBody,\r\n} from \"@sigureya/rpgtypes\";\r\nimport {\r\n  SHOW_MESSAGE,\r\n  SHOW_MESSAGE_BODY,\r\n  type EventCommand,\r\n} from \"@sigureya/rpgtypes\";\r\nimport { pickCommands } from \"./pickCommands\";\r\nimport { ERROR_COMMAND_MESSAGE } from \"./errors\";\r\nimport type { EventCommandPair } from \"./pairTypes\";\r\n\r\nexport const pickMessageHeader = (\r\n  arrya: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): Command_ShowMessage => {\r\n  const head = arrya[start];\r\n  if (head) {\r\n    if (isMessageHeader(head)) {\r\n      return head;\r\n    }\r\n  }\r\n  throw new Error(ERROR_COMMAND_MESSAGE, { cause: head });\r\n};\r\n\r\nexport const isMessageHeader = (\r\n  command: EventCommand | undefined\r\n): command is Command_ShowMessage => {\r\n  if (!command) {\r\n    return false;\r\n  }\r\n  if (command.code !== SHOW_MESSAGE) {\r\n    return false;\r\n  }\r\n  if (![4, 5].includes(command.parameters.length)) {\r\n    return false;\r\n  }\r\n\r\n  return (\r\n    typeof command.parameters[0] === \"string\" &&\r\n    typeof command.parameters[1] === \"number\" &&\r\n    typeof command.parameters[2] === \"number\" &&\r\n    typeof command.parameters[3] === \"number\"\r\n    //    typeof command.parameters[4] === \"string\"\r\n  );\r\n};\r\nexport const pickMessageWithHead = (\r\n  arrya: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): EventCommandPair<Command_ShowMessage, Command_ShowMessageBody> => {\r\n  const head = pickMessageHeader(arrya, start);\r\n  return {\r\n    head: head,\r\n    bodys: pickCommands(SHOW_MESSAGE_BODY, arrya, start + 1),\r\n  };\r\n};\r\n","import type {\r\n  EventCommand,\r\n  Command_ShowScrollingText,\r\n  Command_ShowScrollingTextBody,\r\n} from \"@sigureya/rpgtypes\";\r\nimport {\r\n  SHOW_SCROLLING_TEXT,\r\n  SHOW_SCROLLING_TEXT_BODY,\r\n} from \"@sigureya/rpgtypes\";\r\nimport { codeTest } from \"./commandCheck\";\r\nimport { pickCommands } from \"./pickCommands\";\r\nimport type { CommandReadError } from \"./errors/\";\r\nimport type { EventCommandPair } from \"./pairTypes\";\r\nexport type CommandPair_ScrollingText = EventCommandPair<\r\n  Command_ShowScrollingText,\r\n  Command_ShowScrollingTextBody\r\n>;\r\nexport const ERROR_MESSAGE = \"ScrollTextHeader invalid command\" as const;\r\n\r\nexport const pickScrollTextHeader = (\r\n  array: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): Command_ShowScrollingText => {\r\n  const cmd = array[start];\r\n  if (codeTest(SHOW_SCROLLING_TEXT, cmd)) {\r\n    return cmd;\r\n  }\r\n  const error: CommandReadError = {\r\n    headCode: SHOW_SCROLLING_TEXT,\r\n    bodyCode: SHOW_SCROLLING_TEXT_BODY,\r\n    index: start,\r\n  };\r\n  throw new Error(ERROR_MESSAGE, { cause: error });\r\n};\r\n\r\nexport const pickScrollText = (\r\n  array: ReadonlyArray<EventCommand>,\r\n  start: number\r\n): CommandPair_ScrollingText => {\r\n  const head = pickScrollTextHeader(array, start);\r\n  return {\r\n    head: head,\r\n    bodys: pickCommands(SHOW_SCROLLING_TEXT_BODY, array, start + 1),\r\n  };\r\n};\r\n","import type { EventCode, EventCommandLike } from \"@sigureya/rpgtypes\";\r\n\r\nexport const joinCommandBodies = <\r\n  Command extends EventCommandLike<EventCode, [string]>\r\n>(\r\n  array: ReadonlyArray<Command>,\r\n  sepadrator = \"\\n\"\r\n): string => {\r\n  return array.map((v) => v.parameters[0]).join(sepadrator);\r\n};\r\n","import type * as RpgTypes from \"@sigureya/rpgtypes\";\r\nimport type { EventCommandGroup } from \"./groopTypes\";\r\nimport { joinCommandBodies } from \"./join\";\r\n\r\ntype TextCommandBody = RpgTypes.ExtractCommandByParam<[string]>;\r\nexport abstract class BaseEventCommandGroup<\r\n  Header extends RpgTypes.EventCommand,\r\n  Body extends TextCommandBody\r\n> implements EventCommandGroup<Header, Body>\r\n{\r\n  constructor(public header: Header, public bodies: Body[]) {}\r\n  protected abstract getExpandedBodies(): TextCommandBody[];\r\n  abstract normalizedCommands(): [Header, Body] | [Header];\r\n  abstract mergedBody(): TextCommandBody;\r\n\r\n  getBodyText(separator: string = \"\\n\"): string {\r\n    return joinCommandBodies(this.getExpandedBodies(), separator);\r\n  }\r\n  jopinHedderAndBody(): [Header, ...Body[]] {\r\n    return [this.header, ...this.bodies];\r\n  }\r\n\r\n  joinCommandBodies() {\r\n    return this.getExpandedBodies();\r\n  }\r\n}\r\n\r\nexport class SimpleEventCommandGroup<\r\n  Header extends RpgTypes.EventCommand,\r\n  Body extends TextCommandBody\r\n> extends BaseEventCommandGroup<Header, Body> {\r\n  constructor(public bodyCode: Body[\"code\"], header: Header, bodies: Body[]) {\r\n    super(header, bodies);\r\n  }\r\n  protected getExpandedBodies(): Body[] {\r\n    return this.bodies;\r\n  }\r\n  normalizedCommands(): [Header, Body] | [Header] {\r\n    const headder: Header = {\r\n      ...this.header,\r\n      code: this.header.code,\r\n      indent: this.header.indent,\r\n      parameters: [...this.header.parameters],\r\n    };\r\n    if (this.bodies.length === 0) {\r\n      return [headder];\r\n    }\r\n    return [headder, this.mergedBody()];\r\n  }\r\n  mergedBody(): Body {\r\n    return {\r\n      code: this.bodyCode,\r\n      indent: this.header.indent,\r\n      parameters: [this.getBodyText()],\r\n    } as Body;\r\n  }\r\n}\r\n\r\nexport class CombinedEventCommandGroup<\r\n  Header extends TextCommandBody,\r\n  Body extends TextCommandBody\r\n> extends BaseEventCommandGroup<Header, Body> {\r\n  protected getExpandedBodies(): [Header, ...Body[]] {\r\n    return [this.header, ...this.bodies];\r\n  }\r\n  mergedBody(): Header {\r\n    return {\r\n      code: this.header.code,\r\n      indent: this.header.indent,\r\n      parameters: [this.getBodyText()],\r\n    } as Header;\r\n  }\r\n\r\n  normalizedCommands(): [Header] {\r\n    return [this.mergedBody()];\r\n  }\r\n}\r\n","import type * as RpgTypes from \"@sigureya/rpgtypes\";\r\n\r\n/**\r\n * @description 『MPP_ChoiceEx.js』に対応するための特殊文字列\r\n */\r\nexport const CHOICE_HELP_TEXT = \"選択肢ヘルプ\" as const;\r\n\r\nexport const isChoiceHelp = (command: RpgTypes.Command_Comment) => {\r\n  return command.parameters[0] === CHOICE_HELP_TEXT;\r\n};\r\n","import type {\r\n  Command_ShowMessage,\r\n  Command_ShowMessageBody,\r\n  Command_ShowScrollingText,\r\n  Command_ShowScrollingTextBody,\r\n  Command_Comment,\r\n  Command_CommentBody,\r\n  Command_ScriptHeader,\r\n  Command_ScriptBody,\r\n} from \"@sigureya/rpgtypes\";\r\nimport {\r\n  CombinedEventCommandGroup,\r\n  SimpleEventCommandGroup,\r\n} from \"./commandGroop\";\r\nimport { isChoiceHelp } from \"./commentUtils\";\r\n\r\nexport const createMessageGroup = (\r\n  hedder: Command_ShowMessage,\r\n  bodies: Command_ShowMessageBody[] = []\r\n) => {\r\n  return new SimpleEventCommandGroup<\r\n    Command_ShowMessage,\r\n    Command_ShowMessageBody\r\n  >(401, hedder, bodies);\r\n};\r\n\r\nexport const createScrlloingTextGroup = (\r\n  hedder: Command_ShowScrollingText,\r\n  bodies: Command_ShowScrollingTextBody[] = []\r\n) => {\r\n  return new SimpleEventCommandGroup<\r\n    Command_ShowScrollingText,\r\n    Command_ShowScrollingTextBody\r\n  >(405, hedder, bodies);\r\n};\r\n\r\nexport const createCommentGroup = (\r\n  hedder: Command_Comment,\r\n  bodies: Command_CommentBody[] = []\r\n) => {\r\n  if (isChoiceHelp(hedder)) {\r\n    return new SimpleEventCommandGroup<Command_Comment, Command_CommentBody>(\r\n      408,\r\n      hedder,\r\n      bodies\r\n    );\r\n  }\r\n  return new CombinedEventCommandGroup<Command_Comment, Command_CommentBody>(\r\n    hedder,\r\n    bodies\r\n  );\r\n};\r\n\r\nexport const createScriptGroup = (\r\n  hedder: Command_ScriptHeader,\r\n  bodies: Command_ScriptBody[] = []\r\n) => {\r\n  return new CombinedEventCommandGroup<\r\n    Command_ScriptHeader,\r\n    Command_ScriptBody\r\n  >(hedder, bodies);\r\n};\r\n","import type { EventCommand } from \"@sigureya/rpgtypes\";\r\n\r\nimport {\r\n  pickComments,\r\n  pickMessageWithHead,\r\n  pickScripts,\r\n  pickScrollText,\r\n} from \"./pickCommands\";\r\nimport {\r\n  createMessageGroup,\r\n  createCommentGroup,\r\n  createScriptGroup,\r\n  createScrlloingTextGroup,\r\n} from \"./class\";\r\nimport type {\r\n  EventCommandGroup_Comment,\r\n  EventCommandGroup_Message,\r\n  EventCommandGroup_Script,\r\n  EventCommandGroup_ScrollingText,\r\n} from \"./class\";\r\nexport const handleGroupMessage = <Result>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  func: (groop: EventCommandGroup_Message) => Result\r\n): Result => {\r\n  const pair = pickMessageWithHead(array, index);\r\n\r\n  const group = createMessageGroup(pair.head, pair.bodys);\r\n\r\n  return func(group);\r\n};\r\n\r\nexport const handleGroupScrollingText = <Result>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  func: (groop: EventCommandGroup_ScrollingText) => Result\r\n): Result => {\r\n  const pair = pickScrollText(array, index);\r\n  const group = createScrlloingTextGroup(pair.head, pair.bodys);\r\n  return func(group);\r\n};\r\n\r\nexport const handleGroupComment = <Result>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  func: (group: EventCommandGroup_Comment) => Result\r\n): Result => {\r\n  const pair = pickComments(array, index);\r\n  const group = createCommentGroup(pair.head, pair.bodys);\r\n  return func(group);\r\n};\r\n\r\nexport const handleGroupScript = <Result>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  func: (group: EventCommandGroup_Script) => Result\r\n): Result => {\r\n  const pair = pickScripts(array, index);\r\n  const groop = createScriptGroup(pair.head, pair.bodys);\r\n  return func(groop);\r\n};\r\n","import {\r\n  CHANGE_NAME,\r\n  CHANGE_NICKNAME,\r\n  CHANGE_PROFILE,\r\n  COMMENT,\r\n  SCRIPT_EVAL,\r\n  SHOW_CHOICES,\r\n  SHOW_CHOICES_ITEM,\r\n  SHOW_MESSAGE,\r\n  SHOW_SCROLLING_TEXT,\r\n} from \"@sigureya/rpgtypes\";\r\nimport type { EventCommand } from \"@sigureya/rpgtypes\";\r\nimport {\r\n  handleGroupMessage,\r\n  handleGroupScrollingText,\r\n  handleGroupComment,\r\n  handleGroupScript,\r\n} from \"./commandGroup\";\r\nimport type { TextCommandMapper } from \"./textCommandMapper\";\r\n\r\nexport const handlerDispatch = <T>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  table: TextCommandMapper<T>\r\n): T => {\r\n  const command = array[index];\r\n  switch (command.code) {\r\n    case SHOW_MESSAGE:\r\n      return handleGroupMessage(array, index, table.showMessage);\r\n    case SHOW_SCROLLING_TEXT:\r\n      return handleGroupScrollingText(array, index, table.showScrollingText);\r\n    case COMMENT:\r\n      return handleGroupComment(array, index, table.comment);\r\n    case SCRIPT_EVAL:\r\n      return handleGroupScript(array, index, table.script);\r\n\r\n    case SHOW_CHOICES:\r\n      return table.showChoices(command, index, array);\r\n    case SHOW_CHOICES_ITEM:\r\n      return table.choiceWhen(command, index, array);\r\n    case CHANGE_NAME:\r\n      return table.changeName(command, index, array);\r\n    case CHANGE_PROFILE:\r\n      return table.changeProfile(command, index, array);\r\n    case CHANGE_NICKNAME:\r\n      return table.changeNickname(command, index, array);\r\n\r\n    default:\r\n      return table.other(command, index, array);\r\n  }\r\n};\r\n\r\nexport const mapTextCommand = <T>(\r\n  list: ReadonlyArray<EventCommand>,\r\n  table: TextCommandMapper<T>\r\n): T[] => {\r\n  return list.map<T>((command, index, array) =>\r\n    handlerDispatch(array, index, table)\r\n  );\r\n};\r\n","import type { EventCommand } from \"@sigureya/rpgtypes\";\r\nimport * as Code from \"@sigureya/rpgtypes\";\r\n\r\nimport {\r\n  handleGroupMessage,\r\n  handleGroupScrollingText,\r\n  handleGroupComment,\r\n  handleGroupScript,\r\n} from \"./commandGroup\";\r\nimport type { CallBackFunc } from \"./types\";\r\nimport type { PartialMappingObject } from \"./allCommandsMapper\";\r\n\r\nexport const callHandler = <T, Command extends EventCommand>(\r\n  command: Command,\r\n  index: number,\r\n  array: ReadonlyArray<EventCommand>,\r\n  handler: CallBackFunc<Command, T> | undefined,\r\n  fallback: CallBackFunc<EventCommand, T>\r\n): T => {\r\n  return handler ? handler(command, index, array) : fallback(command, index, array);\r\n};\r\nexport const mappingCommandList = <T>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  table: PartialMappingObject<T>\r\n): T[] => {\r\n  return array.map<T>((command, index) => mappingCommand(array, index, table));\r\n};\r\n\r\nexport const mappingCommand = <T>(\r\n  array: ReadonlyArray<EventCommand>,\r\n  index: number,\r\n  table: PartialMappingObject<T>\r\n): T => {\r\n  const command: EventCommand = array[index];\r\n  switch (command.code) {\r\n    // メッセージ関連\r\n    case Code.SHOW_MESSAGE:\r\n      return table.showMessage\r\n        ? handleGroupMessage(array, index, table.showMessage)\r\n        : table.other(command, index, array);\r\n    case Code.SHOW_MESSAGE_BODY:\r\n      return callHandler(command, index, array, table.showMessageBody, table.other);\r\n    case Code.SHOW_SCROLLING_TEXT:\r\n      return table.showScrollingText\r\n        ? handleGroupScrollingText(array, index, table.showScrollingText)\r\n        : table.other(command, index, array);\r\n    case Code.SHOW_SCROLLING_TEXT_BODY:\r\n      return callHandler(command, index, array, table.showScrollingTextBody, table.other);\r\n    case Code.SHOW_CHOICES:\r\n      return callHandler(command, index, array, table.showChoices, table.other);\r\n    case Code.SHOW_CHOICES_ITEM:\r\n      return callHandler(command, index, array, table.choiceWhen, table.other);\r\n\r\n    // コメント・スクリプト関連\r\n    case Code.COMMENT:\r\n      return table.comment\r\n        ? handleGroupComment(array, index, table.comment)\r\n        : table.other(command, index, array);\r\n    case Code.COMMENT_BODY:\r\n      return callHandler(command, index, array, table.commentBody, table.other);\r\n    case Code.SCRIPT_EVAL:\r\n      return table.script\r\n        ? handleGroupScript(array, index, table.script)\r\n        : table.other(command, index, array);\r\n    case Code.SCRIPT_EVAL_BODY:\r\n      return callHandler(command, index, array, table.scriptBody, table.other);\r\n\r\n    // 条件・制御系\r\n    case Code.CONDITIONAL_BRANCH:\r\n      return callHandler(command, index, array, table.conditionalBranch, table.other);\r\n    case Code.CONTROL_SWITCHES:\r\n      return callHandler(command, index, array, table.controlSwitch, table.other);\r\n    case Code.CONTROL_VARIABLES:\r\n      return callHandler(command, index, array, table.controlVariable, table.other);\r\n    case Code.CONTROL_SELF_SWITCH:\r\n      return callHandler(command, index, array, table.controlSelfSwitch, table.other);\r\n    case Code.CONTROL_TIMER:\r\n      return callHandler(command, index, array, table.controlTimer, table.other);\r\n\r\n    case Code.COMMON_EVENT:\r\n      return callHandler(command, index, array, table.commonEvent, table.other);\r\n    // メニュー\r\n    case Code.CHANGE_SAVE_ACCESS:\r\n      return callHandler(command, index, array, table.changeSaveAccess, table.other);\r\n    case Code.CHANGE_MENU_ACCESS:\r\n      return callHandler(command, index, array, table.changeMenuAccess, table.other);\r\n    case Code.CHANGE_ENCOUNTER:\r\n      return callHandler(command, index, array, table.changeEncounter, table.other);\r\n    case Code.CHANGE_FORMATION_ACCESS:\r\n      return callHandler(command, index, array, table.changeFormationAccess, table.other);\r\n\r\n    // キャラクター情報変更\r\n    case Code.CHANGE_NAME:\r\n      return callHandler(command, index, array, table.changeName, table.other);\r\n    case Code.CHANGE_PROFILE:\r\n      return callHandler(command, index, array, table.changeProfile, table.other);\r\n    case Code.CHANGE_NICKNAME:\r\n      return callHandler(command, index, array, table.changeNickname, table.other);\r\n    case Code.CHANGE_ACTOR_IMAGES:\r\n      return callHandler(command, index, array, table.changeActorImages, table.other);\r\n    case Code.CHANGE_VEHICLE_IMAGE:\r\n      return callHandler(command, index, array, table.changeVehicleImage, table.other);\r\n\r\n    // BGM・音楽関連\r\n    case Code.CHANGE_BATTLE_BGM:\r\n      return callHandler(command, index, array, table.changeBattleBGM, table.other);\r\n    case Code.CHANGE_VICTORY_ME:\r\n      return callHandler(command, index, array, table.changeVictoryME, table.other);\r\n    case Code.CHANGE_DEFEAT_ME:\r\n      return callHandler(command, index, array, table.changeDefeatME, table.other);\r\n\r\n    case Code.PLAY_BGM:\r\n      return callHandler(command, index, array, table.playBGM, table.other);\r\n    case Code.FADEOUT_BGM:\r\n      return callHandler(command, index, array, table.fadeOutBGM, table.other);\r\n    case Code.PLAY_SE:\r\n      return callHandler(command, index, array, table.playSE, table.other);\r\n    case Code.STOP_SE:\r\n      return callHandler(command, index, array, table.stopSE, table.other);\r\n    case Code.PLAY_ME:\r\n      return callHandler(command, index, array, table.playME, table.other);\r\n\r\n    // ラベル・ジャンプ\r\n    case Code.LABEL:\r\n      return callHandler(command, index, array, table.label, table.other);\r\n    case Code.LABEL_JUMP:\r\n      return callHandler(command, index, array, table.labelJump, table.other);\r\n\r\n    // 画面演出\r\n    case Code.CHANGE_WINDOW_COLOR:\r\n      return callHandler(command, index, array, table.changeWindowColor, table.other);\r\n    case Code.TINT_SCREEN:\r\n      return callHandler(command, index, array, table.tintScreen, table.other);\r\n    case Code.FLASH_SCREEN:\r\n      return callHandler(command, index, array, table.flashScreen, table.other);\r\n    case Code.SHAKE_SCREEN:\r\n      return callHandler(command, index, array, table.shakeScreen, table.other);\r\n\r\n    // ピクチャー\r\n    case Code.SHOW_PICTURE:\r\n      return callHandler(command, index, array, table.showPicture, table.other);\r\n    case Code.MOVE_PICTURE:\r\n      return callHandler(command, index, array, table.movePicture, table.other);\r\n    case Code.ROTATE_PICTURE:\r\n      return callHandler(command, index, array, table.rotatePicture, table.other);\r\n    case Code.TINT_PICTURE:\r\n      return callHandler(command, index, array, table.tintPicture, table.other);\r\n    case Code.ERASE_PICTURE:\r\n      return callHandler(command, index, array, table.erasePicture, table.other);\r\n\r\n    // ゲーム進行\r\n    case Code.BATTLE_PROCESSING:\r\n      return callHandler(command, index, array, table.battleProcessing, table.other);\r\n    case Code.WAIT:\r\n      return callHandler(command, index, array, table.wait, table.other);\r\n    case Code.GAME_OVER:\r\n      return callHandler(command, index, array, table.gameover, table.other);\r\n\r\n    // 未整理\r\n    case Code.CHANGE_PARALLAX:\r\n      return callHandler(command, index, array, table.changeParallax, table.other);\r\n    case Code.CHANGE_BATTLE_BACKGROUND:\r\n      return callHandler(command, index, array, table.changeBattleBackground, table.other);\r\n\r\n    case Code.PLAY_MOVIE:\r\n      return callHandler(command, index, array, table.playMovie, table.other);\r\n    case Code.CHANGE_TRANSPARENCY:\r\n      return callHandler(command, index, array, table.changeTransparency, table.other);\r\n    case Code.SET_WEATHER_EFFECT:\r\n      return callHandler(command, index, array, table.setWeatherEffects, table.other);\r\n\r\n    case Code.CHANGE_GOLD:\r\n      return callHandler(command, index, array, table.changeGold, table.other);\r\n    case Code.SHOW_ANIMATION:\r\n      return callHandler(command, index, array, table.showAnimation, table.other);\r\n    case Code.TRANSFER_PLAYER:\r\n      return callHandler(command, index, array, table.transferPlayer, table.other);\r\n    case Code.SET_VEHICLE_LOCATION:\r\n      return callHandler(command, index, array, table.setVehicleLocation, table.other);\r\n    case Code.SET_EVENT_LOCATION:\r\n      return callHandler(command, index, array, table.setEventLocation, table.other);\r\n\r\n    default:\r\n      return table.other(command, index, array);\r\n  }\r\n};\r\n","import type * as RpgTypes from \"@sigureya/rpgtypes\";\r\nimport type { MappingObject } from \"./allCommandsMapper\";\r\nimport { mappingCommandList } from \"./allMapping\";\r\n\r\nexport interface GroupJoinMapper<T>\r\n  extends Pick<\r\n    MappingObject<T>,\r\n    | \"showMessage\"\r\n    | \"showMessageBody\"\r\n    | \"comment\"\r\n    | \"commentBody\"\r\n    | \"script\"\r\n    | \"scriptBody\"\r\n    | \"showScrollingText\"\r\n    | \"showScrollingTextBody\"\r\n    | \"other\"\r\n  > {}\r\n\r\nconst groupJoinMapper: GroupJoinMapper<RpgTypes.EventCommand[]> = {\r\n  // body部分は空の要素で置き換える\r\n  commentBody: () => [],\r\n  showMessageBody: () => [],\r\n  scriptBody: () => [],\r\n  showScrollingTextBody: () => [],\r\n  // ヘッダ側を基準に、Header+Bodyで生成\r\n  showMessage: (data) => data.normalizedCommands(),\r\n  showScrollingText: (data) => data.normalizedCommands(),\r\n  comment: (data) => data.normalizedCommands(),\r\n  script: (data) => data.normalizedCommands(),\r\n  other: (data) => [data],\r\n};\r\n\r\nexport const normalizedCommands = <Command extends RpgTypes.EventCommand>(\r\n  command: ReadonlyArray<Command>\r\n): RpgTypes.EventCommand[][] => {\r\n  return mappingCommandList(command, groupJoinMapper);\r\n};\r\n","import type {\r\n  BattleEventPage,\r\n  Data_CommonEvent,\r\n  Data_Troop,\r\n  MapEventContainer,\r\n} from \"@sigureya/rpgtypes\";\r\nimport type { MapEventContext } from \"./types\";\r\n\r\ninterface EventContainer<Command> {\r\n  id: number;\r\n  pages: {\r\n    list: Command[];\r\n  }[];\r\n}\r\n/**\r\n * Checks whether an event is valid (not null or undefined).\r\n * @param event The event to check.\r\n * @returns `true` if the event is valid, otherwise `false`.\r\n */\r\nconst isValidEvent = <T>(event: T | null | undefined): event is T => {\r\n  return !!event;\r\n};\r\n\r\n/**\r\n * Creates a MapEventContext for an event command.\r\n * @param commands The event commands.\r\n * @param eventId The ID of the event.\r\n * @param pageIndex The index of the page containing the command.\r\n * @returns A MapEventContext object.\r\n */\r\nexport const createEventContext = <T>(\r\n  commands: T,\r\n  eventId: number,\r\n  pageIndex: number\r\n): MapEventContext<T> => ({\r\n  data: commands,\r\n  eventId,\r\n  pageIndex,\r\n});\r\n\r\n/**\r\n * Maps each event command to a MapEventContext.\r\n * @param page The page containing the event commands.\r\n * @param pageIndex The index of the page.\r\n * @param event The event metadata (contains ID).\r\n * @returns An array of MapEventContext objects.\r\n */\r\nexport const createCommandContext = <Command>(\r\n  page: { list: ReadonlyArray<Command> },\r\n  pageIndex: number,\r\n  event: { id: number }\r\n) => {\r\n  return page.list.map<MapEventContext<Command>>((command) => ({\r\n    data: command,\r\n    eventId: event.id,\r\n    pageIndex,\r\n  }));\r\n};\r\n\r\n/**\r\n * Processes all pages within a container and applies a function to each page.\r\n * @param container The container holding multiple event pages.\r\n * @param func The function to apply to each page.\r\n * @returns An array of results obtained by applying the function to each page.\r\n */\r\nexport const processEventPages = <\r\n  Result,\r\n  PageContainer extends { readonly pages: ReadonlyArray<unknown> }\r\n>(\r\n  container: PageContainer,\r\n  func: (\r\n    page: PageContainer[\"pages\"][number],\r\n    pageIndex: number,\r\n    container: PageContainer\r\n  ) => Result\r\n): Result[] => {\r\n  return container.pages.map((page, pageIndex) =>\r\n    func(page, pageIndex, container)\r\n  );\r\n};\r\n\r\n/**\r\n * Processes all events in a map and applies a function to their pages.\r\n * @param map The map containing multiple events.\r\n * @param fn The function to apply to each event page.\r\n * @returns A 2D array where each element represents the processed result of an event's pages.\r\n */\r\nexport const processMapEvents = <Result, Command, Event extends object>(\r\n  map: MapEventContainer<Command, Event & EventContainer<Command>>,\r\n  fn: (\r\n    page: NonNullable<(typeof map)[\"events\"][number]>[\"pages\"][number],\r\n    pageIndex: number,\r\n    container: NonNullable<Event & { id: number; pages: { list: Command[] }[] }>\r\n  ) => Result\r\n): Result[][] => {\r\n  return map.events\r\n    .filter(isValidEvent)\r\n    .map((event) => processEventPages(event, fn));\r\n};\r\n\r\nexport const collectMapEvents = <Result, Command, Event extends { id: number }>(\r\n  map: MapEventContainer<Command, Event & EventContainer<Command>>,\r\n  fn: (\r\n    page: NonNullable<(typeof map)[\"events\"][number]>[\"pages\"][number],\r\n    pageIndex: number,\r\n    container: NonNullable<(typeof map)[\"events\"][number]>\r\n  ) => Result[]\r\n): Result[] => {\r\n  return processMapEvents(map, fn).flat(2);\r\n};\r\n\r\n/**\r\n * Processes all troop event pages.\r\n * @param list The list of troop events.\r\n * @param func The function to apply to each event page.\r\n * @returns A 2D array where each element represents the processed result of a troop's pages.\r\n */\r\nexport const processTroopEvents = <Result>(\r\n  list: ReadonlyArray<Data_Troop>,\r\n  func: (\r\n    page: BattleEventPage,\r\n    pageIndex: number,\r\n    container: Data_Troop\r\n  ) => Result\r\n): Result[][] => {\r\n  return list.map((troop) => processEventPages(troop, func));\r\n};\r\n\r\n/**\r\n * Processes all common events.\r\n * @param events The list of common events.\r\n * @param func The function to apply to each common event.\r\n * @returns An array of processed common events.\r\n */\r\nexport const processCommonEvents = <T>(\r\n  events: ReadonlyArray<Data_CommonEvent>,\r\n  func: (\r\n    common: Readonly<Data_CommonEvent>,\r\n    index: number,\r\n    common2: Readonly<Data_CommonEvent>\r\n  ) => T\r\n): T[] => {\r\n  return events.map((common, index) => func(common, index, common));\r\n};\r\n\r\n/**\r\n * Gathers all event command contexts from a map.\r\n * @param map The map containing events.\r\n * @returns A flattened array of MapEventContext objects representing all event commands in the map.\r\n */\r\nexport const gatherEventCommandContext = <\r\n  Command,\r\n  Event extends EventContainer<Command> = EventContainer<Command>\r\n>(\r\n  map: MapEventContainer<Command, Event>\r\n): MapEventContext<Command>[] => {\r\n  const list: MapEventContext<Command>[][][] = processMapEvents(\r\n    map,\r\n    createCommandContext\r\n  );\r\n  return list.flat(2);\r\n};\r\n","import type {\r\n  Data_CommonEvent,\r\n  Data_Troop,\r\n  EventCommand,\r\n  MapEventContainer,\r\n} from \"@sigureya/rpgtypes\";\r\nimport type { EventCommandContainer } from \"./map/\";\r\n\r\ntype EventCommandReplaceFunc = (\r\n  list: ReadonlyArray<EventCommand>\r\n) => EventCommand[];\r\n\r\nexport const replaceEventCommands = <T extends EventCommandContainer>(\r\n  data: T,\r\n  fn: EventCommandReplaceFunc\r\n): T => {\r\n  const newList: EventCommand[] = fn(data.list);\r\n  return {\r\n    ...data,\r\n    list: newList,\r\n  };\r\n};\r\n\r\nexport const replacePages = <\r\n  Pages extends {\r\n    id: number;\r\n    pages: { readonly list: ReadonlyArray<EventCommand> }[];\r\n  }\r\n>(\r\n  container: Pages,\r\n  fn: EventCommandReplaceFunc\r\n): Pages => {\r\n  return {\r\n    ...container,\r\n    pages: container.pages.map((page) => replaceEventCommands(page, fn)),\r\n  };\r\n};\r\n\r\nexport const replaceMapEvents = <Map extends MapEventContainer<EventCommand>>(\r\n  map: Map,\r\n  fn: EventCommandReplaceFunc\r\n): Map => {\r\n  return {\r\n    ...map,\r\n    events: map.events.map((event) => {\r\n      if (!event) {\r\n        return null;\r\n      }\r\n      return replacePages(event, fn);\r\n    }),\r\n  };\r\n};\r\n\r\nexport const replaceCommonEvents = (\r\n  events: ReadonlyArray<Data_CommonEvent>,\r\n  fn: EventCommandReplaceFunc\r\n): Data_CommonEvent[] => {\r\n  return events.map((commonEvent) => replaceEventCommands(commonEvent, fn));\r\n};\r\n\r\nexport const replaceTroops = (\r\n  list: ReadonlyArray<Data_Troop>,\r\n  fn: EventCommandReplaceFunc\r\n): Data_Troop[] => {\r\n  return list.map((troop) => replacePages(troop, fn));\r\n};\r\n","import type {\r\n  Data_CommonEvent,\r\n  Data_Troop,\r\n  EventCommand,\r\n  MapEventContainer,\r\n} from \"@sigureya/rpgtypes\";\r\nimport { replaceCommonEvents, replaceMapEvents, replaceTroops } from \"./rpg\";\r\nimport { normalizedCommands } from \"./commandMapper\";\r\n\r\nexport const normalizedMapData = <Map extends MapEventContainer<EventCommand>>(\r\n  map: Map\r\n): Map => {\r\n  return replaceMapEvents(map, (list) => normalizedCommands(list).flat());\r\n};\r\nexport const normalizedCommonEvents = (\r\n  commonEvents: ReadonlyArray<Data_CommonEvent>\r\n): Data_CommonEvent[] => {\r\n  return replaceCommonEvents(commonEvents, (list) =>\r\n    normalizedCommands(list).flat()\r\n  );\r\n};\r\n\r\nexport const normalizedTroops = (\r\n  troops: ReadonlyArray<Data_Troop>\r\n): Data_Troop[] => {\r\n  return replaceTroops(troops, (list) => normalizedCommands(list).flat());\r\n};\r\n","import type {\r\n  AudioFileParams,\r\n  EventCode,\r\n  EventCommand,\r\n  ExtractCommandByParam,\r\n} from \"@sigureya/rpgtypes\";\r\nimport * as RpgTypes from \"@sigureya/rpgtypes\";\r\n\r\nexport const matchesEventCommand = <Code extends EventCode>(\r\n  command: EventCommand,\r\n  codeList: ReadonlyArray<Code>\r\n): command is Extract<EventCommand, { code: Code }> => {\r\n  return codeList.includes(command.code as Code);\r\n};\r\nexport const isAudioCommand = (\r\n  command: EventCommand\r\n): command is ExtractCommandByParam<[AudioFileParams]> =>\r\n  matchesEventCommand(command, AUDIO_CODE);\r\n\r\nconst AUDIO_CODE: ReadonlyArray<\r\n  ExtractCommandByParam<[AudioFileParams]>[\"code\"]\r\n> = [\r\n  RpgTypes.PLAY_BGM,\r\n  RpgTypes.PLAY_BGS,\r\n  RpgTypes.PLAY_ME,\r\n  RpgTypes.PLAY_SE,\r\n  RpgTypes.CHANGE_BATTLE_BGM,\r\n  RpgTypes.CHANGE_VICTORY_ME,\r\n  RpgTypes.CHANGE_DEFEAT_ME,\r\n  RpgTypes.CHANGE_VEHICLE_BGM,\r\n];\r\nexport const isImageCommand = (command: EventCommand) =>\r\n  matchesEventCommand(command, IMAGE_CODE);\r\n\r\nconst IMAGE_CODE = [\r\n  RpgTypes.SHOW_PICTURE,\r\n  RpgTypes.CHANGE_ACTOR_IMAGES,\r\n  RpgTypes.CHANGE_VEHICLE_IMAGE,\r\n  RpgTypes.CHANGE_PARALLAX,\r\n  RpgTypes.CHANGE_BATTLE_BACKGROUND,\r\n];\r\n","import type {\r\n  AudioFileParams,\r\n  IndexOfCommandParameter,\r\n} from \"@sigureya/rpgtypes\";\r\n\r\nexport interface CommandParameter<T> {\r\n  code: number;\r\n  paramIndex: number;\r\n  value: T;\r\n}\r\n\r\nexport const pickCommandParamString = <\r\n  Params extends unknown[],\r\n  Index extends IndexOfCommandParameter<\r\n    { code: number; parameters: Params },\r\n    string\r\n  >\r\n>(\r\n  command: { code: number; parameters: Params },\r\n  index: Index\r\n): CommandParameter<Params[Index]> => ({\r\n  code: command.code,\r\n  paramIndex: index,\r\n  value: command.parameters[index],\r\n});\r\n\r\nexport const pickCommandParamNumber = <\r\n  Params extends unknown[],\r\n  Index extends IndexOfCommandParameter<\r\n    { code: number; parameters: Params },\r\n    number\r\n  >\r\n>(\r\n  command: { code: number; parameters: Params },\r\n  index: Index\r\n): CommandParameter<Params[Index]> => ({\r\n  code: command.code,\r\n  paramIndex: index,\r\n  value: command.parameters[index],\r\n});\r\nexport const pickCommandParamAudio = <\r\n  Params extends unknown[],\r\n  Index extends IndexOfCommandParameter<\r\n    { code: number; parameters: Params },\r\n    AudioFileParams\r\n  >\r\n>(\r\n  command: { code: number; parameters: Params },\r\n  index: Index\r\n): CommandParameter<Params[Index]> => ({\r\n  code: command.code,\r\n  paramIndex: index,\r\n  value: command.parameters[index],\r\n});\r\n","import * as RpgTypes from \"@sigureya/rpgtypes\";\r\nimport type { Table_IndexOfDesignation as Table_IndexOfDesignation } from \"./privateTypes\";\r\n\r\nexport const VARIABLE_DESIGNATION = 1 as const;\r\n\r\nexport const DESIGNATION_INDEX_TABLE: Table_IndexOfDesignation = {\r\n  [RpgTypes.CHANGE_ENEMY_HP]: 2,\r\n  [RpgTypes.CHANGE_ENEMY_MP]: 2,\r\n  [RpgTypes.TRANSFER_PLAYER]: 0,\r\n  [RpgTypes.SET_VEHICLE_LOCATION]: 1,\r\n  [RpgTypes.GET_LOCATION_INFO]: 2,\r\n  [RpgTypes.BATTLE_PROCESSING]: 0,\r\n} as const;\r\n\r\nexport const VARIABLEID_INDEX_TABLE = {\r\n  [RpgTypes.CHANGE_ENEMY_HP]: [4],\r\n  [RpgTypes.CHANGE_ENEMY_MP]: [4],\r\n  [RpgTypes.TRANSFER_PLAYER]: [1, 2, 3],\r\n  [RpgTypes.SET_VEHICLE_LOCATION]: [2, 3, 4],\r\n  [RpgTypes.GET_LOCATION_INFO]: [0],\r\n  [RpgTypes.BATTLE_PROCESSING]: [1],\r\n} as const;\r\n","import type { VariableDesignationCommands, VariableReference } from \"./types/\";\r\nimport type { EventCommand } from \"@sigureya/rpgtypes\";\r\n\r\nimport {\r\n  DESIGNATION_INDEX_TABLE,\r\n  VARIABLE_DESIGNATION,\r\n  VARIABLEID_INDEX_TABLE,\r\n} from \"./piravate\";\r\n\r\nexport const extractVariableInfos = (\r\n  commandList: ReadonlyArray<EventCommand>\r\n): VariableReference[] => {\r\n  return commandList\r\n    .filter(isVariableDesignationCommand)\r\n    .flatMap(variableReference);\r\n};\r\n\r\nexport const variableReference = (\r\n  command: VariableDesignationCommands\r\n): VariableReference[] => {\r\n  const indexList = VARIABLEID_INDEX_TABLE[command.code];\r\n  if (indexList === undefined) {\r\n    throw new Error(`code${command.code} is not supported`);\r\n  }\r\n  return indexList.map<VariableReference>((index) => ({\r\n    eventCode: command.code,\r\n    index: index,\r\n    variableId: command.parameters[index] as number,\r\n  }));\r\n};\r\n\r\nexport const isVariableDesignationCommand = (\r\n  command: EventCommand\r\n): command is VariableDesignationCommands => {\r\n  const index =\r\n    DESIGNATION_INDEX_TABLE[\r\n      command.code as keyof typeof DESIGNATION_INDEX_TABLE\r\n    ];\r\n  if (index === undefined) {\r\n    return false;\r\n  }\r\n  return command.parameters[index] === VARIABLE_DESIGNATION;\r\n};\r\n","import type {\r\n  Command_ControlVariables,\r\n  CONTROL_VARIABLES,\r\n  ControlVariables,\r\n  EventCommand,\r\n  EventCommandLike,\r\n  Operand_Constatant,\r\n  Operand_Variable,\r\n} from \"@sigureya/rpgtypes\";\r\n\r\nexport const commandParamIs = <Param extends ControlVariables>(\r\n  command: EventCommand,\r\n  operandCode: Param[3]\r\n): command is EventCommandLike<typeof CONTROL_VARIABLES, Param> => {\r\n  return (\r\n    command.parameters[3] === operandCode &&\r\n    command.parameters[3] === operandCode\r\n  );\r\n};\r\nexport const operandIsConstants = (\r\n  command: Command_ControlVariables\r\n): command is Command_ControlVariables<Operand_Constatant> => {\r\n  return commandParamIs(command, 0);\r\n};\r\n\r\nexport const operandIsVariable = (\r\n  command: Command_ControlVariables\r\n): command is Command_ControlVariables<Operand_Variable> => {\r\n  return commandParamIs(command, 1);\r\n};\r\n","import type { NoteReadResult } from \"./types\";\r\n\r\nexport const createNoteEntity = (key: string, value: string): string => {\r\n  return `<${key}:${value}>`;\r\n};\r\n\r\nexport const makeRegex = () => /<([^<>:]+):([^>]*)>/g;\r\n\r\nexport const readNoteObject = <Result, T extends { note: string }>(\r\n  data: T,\r\n  fn: (key: string, value: string, data: T) => Result\r\n): Result[] => readNoteEx(data.note, (key, value) => fn(key, value, data));\r\n\r\nexport const readNote = (note: string): NoteReadResult[] => {\r\n  return readNoteEx(note, (key, value) => [key, value]);\r\n};\r\n/**\r\n * note文字列を解析し、キーと値のペアを取得します。\r\n * タグが閉じられていない場合、その要素は無視されます。\r\n */\r\nexport const readNoteEx = <Result>(\r\n  note: string,\r\n  fn: (key: string, value: string) => Result\r\n): Result[] => {\r\n  const regex = makeRegex();\r\n  const result: Result[] = [];\r\n  let match: RegExpExecArray | null;\r\n\r\n  while ((match = regex.exec(note)) !== null) {\r\n    result.push(fn(match[1], match[2]));\r\n  }\r\n  return result;\r\n};\r\n/**\r\n *\r\n * @param note\r\n * @param transformFunction この関数の戻り値でvalueを置き換える\r\n * @returns\r\n */\r\nexport const replaceNote = (\r\n  note: string,\r\n  transformFunction: (key: string, value: string) => string\r\n): string => {\r\n  return note.replace(makeRegex(), (_subString, key: string, value: string) => {\r\n    const newText = transformFunction(key, value);\r\n    return createNoteEntity(key, newText);\r\n  });\r\n};\r\n\r\nexport const getNoteValue = (\r\n  note: string,\r\n  targetKey: string\r\n): string | undefined => {\r\n  const regex = makeRegex();\r\n  let match: RegExpExecArray | null;\r\n\r\n  while ((match = regex.exec(note)) !== null) {\r\n    if (match[1] === targetKey) {\r\n      return match[2];\r\n    }\r\n  }\r\n  return undefined;\r\n};\r\n\r\nexport const setNoteValue = (\r\n  note: string,\r\n  targetKey: string,\r\n  newValue: string\r\n): string => {\r\n  const regex = makeRegex();\r\n\r\n  return note.replace(regex, (match, key: string) => {\r\n    if (key === targetKey) {\r\n      return createNoteEntity(key, newValue); // 対象キーの場合のみ値を差し替え\r\n    }\r\n    return match; // 対象外はそのまま\r\n  });\r\n};\r\n","import type { EventCode } from \"@sigureya/rpgtypes\";\r\n\r\nexport const codeInfoText = (code: EventCode) => {\r\n  return `code:${code}`;\r\n};\r\n","export const ACTOR = \"N\" as const;\r\nexport const VARIABLE = \"V\" as const;\r\n","import type { Data_Actor, Data_System } from \"@sigureya/rpgtypes\";\r\nimport { ACTOR, VARIABLE } from \"./constants\";\r\nimport type { ControlCharInfo, ControlChars } from \"./types\";\r\n\r\nexport const createControlCharFormat = <C extends ControlChars>(\r\n  char: C,\r\n  id: number\r\n) => {\r\n  return `\\\\${char}[${id}]` as const;\r\n};\r\n\r\nexport const fromActor = (actor: Data_Actor) => {\r\n  return createControlCharFormat(ACTOR, actor.id);\r\n};\r\n\r\nexport const fromActors = (\r\n  actors: ReadonlyArray<Data_Actor>\r\n): ControlCharInfo[] => {\r\n  return actors.map<ControlCharInfo>((actor) => ({\r\n    controlChar: fromActor(actor),\r\n    text: actor.name,\r\n  }));\r\n};\r\nexport const fromSystem = (system: Data_System): ControlCharInfo[] => {\r\n  return system.variables\r\n    .map<ControlCharInfo>((name, index) => ({\r\n      text: name || \"\",\r\n      controlChar: createControlCharFormat(VARIABLE, index),\r\n    }))\r\n    .filter((pair) => pair.text !== \"\");\r\n};\r\n","export interface ControlChar {\r\n  char: string; // 制御文字\r\n  id: number; // 数字部分\r\n}\r\n\r\nconst defaultSet: ReadonlySet<Lowercase<string>> = new Set([\r\n  \"px\",\r\n  \"py\",\r\n  \"x\",\r\n  \"y\",\r\n  \"v\",\r\n  \"n\",\r\n  \"p\",\r\n  \"g\",\r\n  \"c\",\r\n  \"i\",\r\n  \"fs\",\r\n]);\r\n\r\n/**\r\n * 指定されたテキストから制御文字を抽出し、ControlChar配列として返します。\r\n * 制御文字の形式: \\(文字)[数字]\r\n * 文字の大文字小文字を区別しない。\r\n */\r\nexport const getControlChars = (\r\n  text: string,\r\n  validChars: ReadonlySet<Lowercase<string>> = defaultSet\r\n): ControlChar[] => {\r\n  // 正規表現: \\(制御文字)[数字]\r\n  const regex = /\\\\([A-Za-z]+)\\[(\\d+)]/g;\r\n\r\n  const controlChars: ControlChar[] = [];\r\n  let match: RegExpExecArray | null;\r\n\r\n  while ((match = regex.exec(text)) !== null) {\r\n    const char = match[1].toLowerCase() as Lowercase<string>;\r\n    const id = parseInt(match[2], 10);\r\n\r\n    if (validChars.has(char)) {\r\n      controlChars.push({ char: match[1], id }); // 大文字小文字区別しないが元の文字を保持\r\n    }\r\n  }\r\n\r\n  return controlChars;\r\n};\r\n","import type { PickByType } from \"@sigureya/rpgtypes\";\r\n\r\nexport type PickableRecordType<T, Value> = Record<\r\n  string & keyof PickByType<T, Value>,\r\n  Value\r\n>;\r\n\r\nexport const pickPropertys = <\r\n  Result,\r\n  Value,\r\n  T extends PickableRecordType<T, Value>\r\n>(\r\n  data: T,\r\n  keyList: ReadonlyArray<keyof PickableRecordType<T, string>>,\r\n  fn: (key: string, value: Value, data: T) => Result\r\n): Result[] => {\r\n  return keyList.map((key) => fn(key, data[key], data));\r\n};\r\n\r\nexport const pickString = <Result, T extends PickableRecordType<T, string>>(\r\n  data: T,\r\n  keyList: ReadonlyArray<keyof PickableRecordType<T, string>>,\r\n  fn: (key: string, value: string, data: T) => Result\r\n): Result[] => {\r\n  return pickPropertys(data, keyList, fn);\r\n};\r\n"],"names":["constructParamArray","constructActor","proto","constructEnemy","constructArmor","constructWeapon","constructDamage","constructClass","constructItem","constructSkill","constructState","createMap","createMapEvent","arg","createEventPage","createCondtion","createMapEventImage","createAudio","audio","createAudioCommand","code","name","indent","createSystemData","system","createTerms","createAdvanced","createSystemSoundsArray","createVehicle","createMessages","createCommandsArray","createParamNamesArray","createBasicTerms","names","codeTest","command","ERROR_COMMAND_MESSAGE","ERROR_COMMAND_SCRIPT","ERROR_INVALID_HEAD","isBodyParams","param","isHeadCommand","pickCommands","arrya","start","result","i","pickHead","commands","index","head","pickComments","array","COMMENT","COMMENT_BODY","pickScripts","SCRIPT_EVAL","SCRIPT_EVAL_BODY","pickMessageHeader","isMessageHeader","SHOW_MESSAGE","pickMessageWithHead","SHOW_MESSAGE_BODY","ERROR_MESSAGE","pickScrollTextHeader","cmd","SHOW_SCROLLING_TEXT","error","SHOW_SCROLLING_TEXT_BODY","pickScrollText","joinCommandBodies","sepadrator","v","BaseEventCommandGroup","header","bodies","separator","SimpleEventCommandGroup","bodyCode","headder","CombinedEventCommandGroup","CHOICE_HELP_TEXT","isChoiceHelp","createMessageGroup","hedder","createScrlloingTextGroup","createCommentGroup","createScriptGroup","handleGroupMessage","func","pair","group","handleGroupScrollingText","handleGroupComment","handleGroupScript","groop","handlerDispatch","table","SHOW_CHOICES","SHOW_CHOICES_ITEM","CHANGE_NAME","CHANGE_PROFILE","CHANGE_NICKNAME","mapTextCommand","list","callHandler","handler","fallback","mappingCommandList","mappingCommand","Code","groupJoinMapper","data","normalizedCommands","isValidEvent","event","createEventContext","eventId","pageIndex","createCommandContext","page","processEventPages","container","processMapEvents","map","fn","collectMapEvents","processTroopEvents","troop","processCommonEvents","events","common","gatherEventCommandContext","replaceEventCommands","newList","replacePages","replaceMapEvents","replaceCommonEvents","commonEvent","replaceTroops","normalizedMapData","normalizedCommonEvents","commonEvents","normalizedTroops","troops","matchesEventCommand","codeList","isAudioCommand","AUDIO_CODE","RpgTypes","isImageCommand","IMAGE_CODE","pickCommandParamString","pickCommandParamNumber","pickCommandParamAudio","VARIABLE_DESIGNATION","DESIGNATION_INDEX_TABLE","VARIABLEID_INDEX_TABLE","extractVariableInfos","commandList","isVariableDesignationCommand","variableReference","indexList","commandParamIs","operandCode","operandIsConstants","operandIsVariable","createNoteEntity","key","value","makeRegex","readNoteObject","readNoteEx","readNote","note","regex","match","replaceNote","transformFunction","_subString","newText","getNoteValue","targetKey","setNoteValue","newValue","codeInfoText","ACTOR","VARIABLE","createControlCharFormat","char","id","fromActor","actor","fromActors","actors","fromSystem","defaultSet","getControlChars","text","validChars","controlChars","pickPropertys","keyList","pickString"],"mappings":"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"}