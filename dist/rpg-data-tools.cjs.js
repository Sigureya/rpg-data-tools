"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("@sigureya/rpgtypes");function pe(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const a in e)if(a!=="default"){const n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:()=>e[a]})}}return t.default=e,Object.freeze(t)}const r=pe(i),u=()=>[0,0,0,0,0,0,0,0],Ee=e=>({id:0,name:"",nickname:"",profile:"",note:"",classId:0,initialLevel:1,maxLevel:99,characterIndex:0,characterName:"",faceIndex:0,faceName:"",battlerName:"",traits:[],equips:[],...e}),ge=e=>({battlerHue:0,id:0,name:"",note:"",battlerName:"",traits:[],params:u(),exp:0,gold:0,dropItems:[],actions:[],...e}),Ce=e=>({price:0,id:0,name:"",note:"",iconIndex:0,description:"",etypeId:0,params:u(),traits:[],...e}),Se=e=>({price:0,id:0,name:"",note:"",iconIndex:0,description:"",etypeId:0,wtypeId:0,params:u(),traits:[],damage:p(),...e}),Te=e=>({id:0,name:"",note:"",traits:[],learnings:[],params:u(),expParams:[],...e}),p=e=>({type:0,elementId:0,formula:"0",variance:20,critical:!1,...e}),fe=e=>({id:0,name:"",iconIndex:0,description:"",note:"",price:0,consumable:!1,scope:0,occasion:0,speed:0,successRate:100,repeats:1,tpGain:0,hitType:0,animationId:0,damage:p(),effects:[],...e}),Ne=e=>({animationId:0,damage:p(),description:"",hitType:0,iconIndex:0,id:0,message1:"",message2:"",mpCost:0,name:"",note:"",occasion:0,repeats:1,requiredWtypeId1:0,requiredWtypeId2:0,scope:0,speed:0,stypeId:0,successRate:100,tpCost:0,tpGain:0,effects:[],messageType:0,...e}),Ae=e=>({id:0,name:"",iconIndex:0,restriction:0,priority:50,motion:0,overlay:0,removeAtBattleEnd:!1,removeByRestriction:!1,autoRemovalTiming:0,minTurns:1,maxTurns:1,removeByDamage:!1,chanceByDamage:100,removeByWalking:!1,stepsToRemove:100,message1:"",message2:"",message3:"",message4:"",traits:[],note:"",...e}),Ie=e=>({autoplayBgm:!0,autoplayBgs:!1,battleback1Name:"",battleback2Name:"",data:[],disableDashing:!1,displayName:"",encounterList:[],events:[],height:0,note:"",width:0,x:0,y:0,parallaxName:"",parallaxLoopX:!1,parallaxLoopY:!1,parallaxShow:!1,parallaxSx:0,parallaxSy:0,...e}),Me=e=>({id:0,name:"",note:"",x:0,y:0,pages:[k()],...e}),D=e=>({actorId:0,actorValid:!1,itemId:0,itemValid:!1,selfSwitchCh:"",selfSwitchValid:!1,switch1Id:0,switch1Valid:!1,switch2Id:0,switch2Valid:!1,variableId:0,variableValid:!1,variableValue:0,...e}),B=e=>({characterIndex:0,characterName:"",direction:6,pattern:0,tileId:0,...e}),k=e=>({conditions:D(),image:B(),moveRoute:{list:[],repeat:!1,wait:!1,skippable:!1},directionFix:!1,moveFrequency:0,list:[],...e}),c=()=>({name:"",pan:0,pitch:100,volume:90}),_e=(e={})=>({local:e.local??"",gameTitle:e.gameTitle??"",currencyUnit:e.currencyUnit??"",title1Name:e.title1Name??"",terms:e.terms??V(),title2Name:e.title2Name??"",optAutosave:e.optAutosave??!1,attackMotions:e.attackMotions??[],startMapId:e.startMapId??0,startX:e.startX??0,startY:e.startY??0,switches:e.switches??[],windowTone:e.windowTone??[0,0,0,0],editMapId:e.editMapId??0,testTroopId:e.testTroopId??0,testBattlers:e.testBattlers??[],versionId:e.versionId??0,advanced:e.advanced??y(),armorTypes:e.armorTypes??[],elements:e.elements??[],variables:e.variables??[],equipTypes:e.equipTypes??[],sounds:e.sounds??z(),titleBgm:e.titleBgm??c(),gameoverMe:e.gameoverMe??c(),battleBgm:e.battleBgm??c(),defeatMe:e.defeatMe??c(),victoryMe:e.victoryMe??c(),battleback1Name:e.battleback1Name??"",battleback2Name:e.battleback2Name??"",battlerName:e.battlerName??"",weaponTypes:e.weaponTypes??[],skillTypes:e.skillTypes??[],optDisplayTp:e.optDisplayTp??!1,optDrawTitle:e.optDrawTitle??!1,optExtraExp:e.optExtraExp??!1,optFloorDeath:e.optFloorDeath??!1,optFollowers:e.optFollowers??!1,optKeyItemsNumber:e.optKeyItemsNumber??!1,optSideView:e.optSideView??!1,optSlipDeath:e.optSlipDeath??!1,optTransparent:e.optTransparent??!1,boat:e.boat??h(),ship:e.ship??h(),airship:e.airship??h(),tileSize:e.tileSize??0}),V=(e={})=>({messages:F(e.messages??{}),commands:x(e.commands??{}),params:W(e.params??{}),basic:P(e.basic??{})}),P=(e={})=>[e.level??"",e.levelA??"",e.hp??"",e.hpA??"",e.mp??"",e.mpA??"",e.tp??"",e.tpA??"",e.experience??"",e.exp??""],W=(e={})=>[e.mhp??"",e.mmp??"",e.atk??"",e.def??"",e.mat??"",e.mdf??"",e.agi??"",e.luk??"",e.hit??"",e.eva??""],x=(e={})=>[e.fight??"",e.escape??"",e.attack??"",e.guard??"",e.item??"",e.skill??"",e.equip??"",e.status??"",e.formation??"",e.save??"",e.gameEnd??"",e.options??"",e.weapon??"",e.armor??"",e.keyItem??"",e.equip2??"",e.optimize??"",e.clear??"",e.newGame??"",e.continue_??"",e.notUsed20??"",e.toTitle??"",e.cancel??"",e.notUsed23??"",e.buy??"",e.sell??""],F=(e={})=>({alwaysDash:e.alwaysDash??"",commandRemember:e.commandRemember??"",touchUI:e.touchUI??"",bgmVolume:e.bgmVolume??"",bgsVolume:e.bgsVolume??"",meVolume:e.meVolume??"",seVolume:e.seVolume??"",possession:e.possession??"",expTotal:e.expTotal??"",expNext:e.expNext??"",saveMessage:e.saveMessage??"",loadMessage:e.loadMessage??"",file:e.file??"",autosave:e.autosave??"",partyName:e.partyName??"",emerge:e.emerge??"",preemptive:e.preemptive??"",surprise:e.surprise??"",escapeStart:e.escapeStart??"",escapeFailure:e.escapeFailure??"",victory:e.victory??"",defeat:e.defeat??"",obtainExp:e.obtainExp??"",obtainGold:e.obtainGold??"",obtainItem:e.obtainItem??"",levelUp:e.levelUp??"",obtainSkill:e.obtainSkill??"",useItem:e.useItem??"",criticalToEnemy:e.criticalToEnemy??"",criticalToActor:e.criticalToActor??"",actorDamage:e.actorDamage??"",actorRecovery:e.actorRecovery??"",actorGain:e.actorGain??"",actorLoss:e.actorLoss??"",actorDrain:e.actorDrain??"",actorNoDamage:e.actorNoDamage??"",actorNoHit:e.actorNoHit??"",enemyDamage:e.enemyDamage??"",enemyRecovery:e.enemyRecovery??"",enemyGain:e.enemyGain??"",enemyLoss:e.enemyLoss??"",enemyDrain:e.enemyDrain??"",enemyNoDamage:e.enemyNoDamage??"",enemyNoHit:e.enemyNoHit??"",evasion:e.evasion??"",magicEvasion:e.magicEvasion??"",magicReflection:e.magicReflection??"",counterAttack:e.counterAttack??"",substitute:e.substitute??"",buffAdd:e.buffAdd??"",debuffAdd:e.debuffAdd??"",buffRemove:e.buffRemove??"",actionFailure:e.actionFailure??""}),y=(e={})=>({gameId:e.gameId??0,screenWidth:e.screenWidth??0,screenHeight:e.screenHeight??0,uiAreaWidth:e.uiAreaWidth??0,uiAreaHeight:e.uiAreaHeight??0,windowOpacity:e.windowOpacity??0,screenScale:e.screenScale??0,numberFontFilename:e.numberFontFilename??"",mainFontFilename:e.mainFontFilename??"",fallbackFonts:e.fallbackFonts??"",fontSize:e.fontSize??0}),h=(e={})=>({bgm:e.bgm??c(),characterIndex:e.characterIndex??0,characterName:e.characterName??"",startMapId:e.startMapId??0,startX:e.startX??0,startY:e.startY??0}),z=(e={})=>[e.cursor??c(),e.ok??c(),e.cancel??c(),e.buzzer??c(),e.equip??c(),e.save??c(),e.load??c(),e.battleStart??c(),e.escape??c(),e.enemyAttack??c(),e.enemyDamage??c(),e.enemyCollapse??c(),e.bossCollapse1??c(),e.bossCollapse2??c(),e.actorDamage??c(),e.actorCollapse??c(),e.playRecovery??c(),e.playMiss??c(),e.playEvasion??c(),e.playMagicEvasion??c(),e.playReflection??c(),e.shop??c(),e.useItem??c(),e.useSkill??c()],E=(e,t)=>t?e===t.code:!1,Y="MessageHeader invalid command",ve="Script invalid command",X="Invalid Head",g=e=>typeof e[0]=="string"&&e.length===1,Oe=(e,t)=>t?e===t.code&&g(t.parameters):!1,l=(e,t,a)=>{const n=[];for(let o=a;o<t.length;o++){const m=t[o];if(E(e,m)&&g(m.parameters))n.push({code:e,indent:m.indent,parameters:[m.parameters[0]]});else break}return n},S=(e,t,a)=>{const n=e[t];if(n&&E(a,n)&&g(n.parameters))return{code:a,indent:n.indent,parameters:[n.parameters[0]]};throw new Error(X,{cause:n})},b=(e,t)=>({head:S(e,t,i.COMMENT),bodys:l(i.COMMENT_BODY,e,t+1)}),j=(e,t)=>({head:S(e,t,i.SCRIPT_EVAL),bodys:l(i.SCRIPT_EVAL_BODY,e,t+1)}),U=(e,t)=>{const a=e[t];if(a&&q(a))return a;throw new Error(Y,{cause:a})},q=e=>!e||e.code!==i.SHOW_MESSAGE||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",K=(e,t)=>({head:U(e,t),bodys:l(i.SHOW_MESSAGE_BODY,e,t+1)}),$="ScrollTextHeader invalid command",J=(e,t)=>{const a=e[t];if(E(i.SHOW_SCROLLING_TEXT,a))return a;const n={headCode:i.SHOW_SCROLLING_TEXT,bodyCode:i.SHOW_SCROLLING_TEXT_BODY,index:t};throw new Error($,{cause:n})},Z=(e,t)=>({head:J(e,t),bodys:l(i.SHOW_SCROLLING_TEXT_BODY,e,t+1)}),T=(e,t=`
`)=>e.map(a=>a.parameters[0]).join(t);class f{constructor(t,a){this.header=t,this.bodies=a}getBodyText(t=`
`){return T(this.getExpandedBodies(),t)}joinCommandBodies(){return this.getExpandedBodies()}}class N extends f{constructor(t,a,n){super(a,n),this.bodyCode=t}getExpandedBodies(){return this.bodies}normalizedCommands(){const t={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};if(this.bodies.length===0)return[t];const a={code:this.bodyCode,indent:0,parameters:[this.getBodyText()]};return[t,a]}}class A extends f{constructor(t,a){super(t,a)}getExpandedBodies(){return[this.header,...this.bodies]}normalizedCommands(){const t=this.getBodyText();return[{code:this.header.code,parameters:[t],indent:this.header.indent}]}}const Q=(e,t=[])=>new N(401,e,t),ee=(e,t=[])=>new N(405,e,t),te=(e,t=[])=>new A(e,t),ae=(e,t=[])=>new A(e,t),I=(e,t,a)=>{const n=K(e,t),o=Q(n.head,n.bodys);return a(o)},M=(e,t,a)=>{const n=Z(e,t),o=ee(n.head,n.bodys);return a(o)},_=(e,t,a)=>{const n=b(e,t),o=te(n.head,n.bodys);return a(o)},v=(e,t,a)=>{const n=j(e,t),o=ae(n.head,n.bodys);return a(o)},ne=(e,t,a)=>{const n=e[t];switch(n.code){case i.SHOW_MESSAGE:return I(e,t,a.showMessage);case i.SHOW_SCROLLING_TEXT:return M(e,t,a.showScrollingText);case i.COMMENT:return _(e,t,a.comment);case i.SCRIPT_EVAL:return v(e,t,a.script);case i.SHOW_CHOICES:return a.showChoices(n,t,e);case i.SHOW_CHOICES_ITEM:return a.choiceWhen(n,t,e);case i.CHANGE_NAME:return a.changeName(n,t,e);case i.CHANGE_PROFILE:return a.changeProfile(n,t,e);case i.CHANGE_NICKNAME:return a.changeNickname(n,t,e);default:return a.other(n,t,e)}},Re=(e,t)=>e.map((a,n,o)=>ne(o,n,t)),s=(e,t,a,n,o)=>n?n(e,t,a):o(e,t,a),He=(e,t,a)=>{const n=e[t];switch(n.code){case r.SHOW_MESSAGE:return a.showMessage?I(e,t,a.showMessage):a.other(n,t,e);case r.SHOW_MESSAGE_BODY:return s(n,t,e,a.showMessageBody,a.other);case r.SHOW_SCROLLING_TEXT:return a.showScrollingText?M(e,t,a.showScrollingText):a.other(n,t,e);case r.SHOW_SCROLLING_TEXT_BODY:return s(n,t,e,a.showScrollingTextBody,a.other);case r.COMMENT:return a.comment?_(e,t,a.comment):a.other(n,t,e);case r.COMMENT_BODY:return s(n,t,e,a.commentBody,a.other);case r.SCRIPT_EVAL:return a.script?v(e,t,a.script):a.other(n,t,e);case r.SCRIPT_EVAL_BODY:return s(n,t,e,a.scriptBody,a.other);case r.CONTROL_SWITCHES:return s(n,t,e,a.controlSwitch,a.other);case r.CONTROL_VARIABLES:return s(n,t,e,a.controlVariable,a.other);case r.CONTROL_SELF_SWITCH:return s(n,t,e,a.controlSelfSwitch,a.other);case r.CONTROL_TIMER:return s(n,t,e,a.controlTimer,a.other);case r.CONDITIONAL_BRANCH:return s(n,t,e,a.conditionalBranch,a.other);case r.SHOW_CHOICES:return s(n,t,e,a.showChoices,a.other);case r.SHOW_CHOICES_ITEM:return s(n,t,e,a.choiceWhen,a.other);case r.CHANGE_NAME:return s(n,t,e,a.changeName,a.other);case r.CHANGE_PROFILE:return s(n,t,e,a.changeProfile,a.other);case r.CHANGE_NICKNAME:return s(n,t,e,a.changeNickname,a.other);case r.COMMON_EVENT:return s(n,t,e,a.commonEvent,a.other);case r.LABEL:return s(n,t,e,a.label,a.other);case r.LABEL_JUMP:return s(n,t,e,a.labelJump,a.other);case r.CHANGE_BATTLE_BGM:return s(n,t,e,a.changeBattleBGM,a.other);case r.CHANGE_VICTORY_ME:return s(n,t,e,a.changeVictoryME,a.other);case r.CHANGE_DEFEAT_ME:return s(n,t,e,a.changeDefeatME,a.other);case r.CHANGE_SAVE_ACCESS:return s(n,t,e,a.changeSaveAccess,a.other);case r.CHANGE_MENU_ACCESS:return s(n,t,e,a.changeMenuAccess,a.other);case r.CHANGE_ENCOUNTER:return s(n,t,e,a.changeEncounter,a.other);case r.CHANGE_FORMATION_ACCESS:return s(n,t,e,a.changeFormationAccess,a.other);case r.CHANGE_WINDOW_COLOR:return s(n,t,e,a.changeWindowColor,a.other);case r.TINT_SCREEN:return s(n,t,e,a.tintScreen,a.other);case r.FLASH_SCREEN:return s(n,t,e,a.flashScreen,a.other);case r.SHAKE_SCREEN:return s(n,t,e,a.shakeScreen,a.other);case r.BATTLE_PROCESSING:return s(n,t,e,a.battleProcessing,a.other);case r.WAIT:return s(n,t,e,a.wait,a.other);case r.CHANGE_ACTOR_IMAGES:return s(n,t,e,a.changeActorImages,a.other);case r.CHANGE_GOLD:return s(n,t,e,a.changeGold,a.other);case r.SHOW_ANIMATION:return s(n,t,e,a.showAnimation,a.other);case r.TRANSFER_PLAYER:return s(n,t,e,a.transferPlayer,a.other);case r.SET_VEHICLE_LOCATION:return s(n,t,e,a.setVehicleLocation,a.other);case r.SET_EVENT_LOCATION:return s(n,t,e,a.setEventLocation,a.other);case r.GAME_OVER:return s(n,t,e,a.gameover,a.other)}return a.other(n,t,e)},O="選択肢ヘルプ",re=e=>e.parameters[0]===O,we=e=>{if(re(e.header)){const t=T(e.bodies);return[{code:r.COMMENT,indent:0,parameters:[O]},{code:r.COMMENT_BODY,indent:0,parameters:[t]}]}return e.normalizedCommands()},Ge={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>we(e),script:e=>e.normalizedCommands(),other:e=>[e]},C=e=>e.map((t,a,n)=>He(n,a,Ge)),se=e=>!!e,ce=(e,t,a)=>({command:e,eventId:t,pageIndex:a}),oe=(e,t)=>e.pages.map((a,n)=>a.list.map(o=>t(o,e.id,n))),Le=e=>e.events.filter(se).map(a=>oe(a,ce)).flat(2),R=(e,t)=>{const a=t(e.list);return{...e,list:a}},H=(e,t)=>({...e,pages:e.pages.map(a=>R(a,t))}),ie=(e,t)=>({...e,events:e.events.map(a=>a?H(a,t):null)}),me=(e,t)=>e.map(a=>R(a,t)),ue=(e,t)=>e.map(a=>H(a,t)),De=e=>ie(e,t=>C(t).flat()),Be=e=>me(e,t=>C(t).flat()),ke=e=>ue(e,t=>C(t).flat()),w=(e,t)=>`<${e}:${t}>`,d=()=>/<([^<>:]+):([^>]*)>/g,Ve=(e,t)=>G(e.note,(a,n)=>t(a,n,e)),Pe=e=>G(e,(t,a)=>[t,a]),G=(e,t)=>{const a=d(),n=[];let o;for(;(o=a.exec(e))!==null;)n.push(t(o[1],o[2]));return n},We=(e,t)=>e.replace(d(),(a,n,o)=>{const m=t(n,o);return w(n,m)}),xe=(e,t)=>{const a=d();let n;for(;(n=a.exec(e))!==null;)if(n[1]===t)return n[2]},Fe=(e,t,a)=>{const n=d();return e.replace(n,(o,m)=>m===t?w(m,a):o)},ye=e=>`code:${e}`,ze="N",Ye="V",L=(e,t)=>`\\${e}[${t}]`,le=e=>L(ze,e.id),Xe=e=>e.map(t=>({controlChar:le(t),text:t.name})),be=e=>e.variables.map((t,a)=>({text:t||"",controlChar:L(Ye,a)})).filter(t=>t.text!==""),je=new Set(["px","py","x","y","v","n","p","g","c","i","fs"]),Ue=(e,t=je)=>{const a=/\\([A-Za-z]+)\[(\d+)]/g,n=[];let o;for(;(o=a.exec(e))!==null;){const m=o[1].toLowerCase(),he=parseInt(o[2],10);t.has(m)&&n.push({char:o[1],id:he})}return n},de=(e,t,a)=>t.map(n=>a(n,e[n],e)),qe=(e,t,a)=>de(e,t,a),Ke=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]}),$e=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]});exports.BaseEventCommandGroup=f;exports.CHOICE_HELP_TEXT=O;exports.CombinedEventCommandGroup=A;exports.ERROR_COMMAND_MESSAGE=Y;exports.ERROR_COMMAND_SCRIPT=ve;exports.ERROR_INVALID_HEAD=X;exports.ERROR_MESSAGE=$;exports.SimpleEventCommandGroup=N;exports.codeInfoText=ye;exports.codeTest=E;exports.constructActor=Ee;exports.constructArmor=Ce;exports.constructClass=Te;exports.constructDamage=p;exports.constructEnemy=ge;exports.constructItem=fe;exports.constructParamArray=u;exports.constructSkill=Ne;exports.constructState=Ae;exports.constructWeapon=Se;exports.createAdvanced=y;exports.createAudio=c;exports.createBasicTerms=P;exports.createCommandsArray=x;exports.createCommentGroup=te;exports.createCondtion=D;exports.createControlCharFormat=L;exports.createEventPage=k;exports.createMap=Ie;exports.createMapEvent=Me;exports.createMapEventContext=ce;exports.createMapEventImage=B;exports.createMessageGroup=Q;exports.createMessages=F;exports.createNoteEntity=w;exports.createParamNamesArray=W;exports.createScriptGroup=ae;exports.createScrlloingTextGroup=ee;exports.createSystemData=_e;exports.createSystemSoundsArray=z;exports.createTerms=V;exports.createVehicle=h;exports.fromActor=le;exports.fromActors=Xe;exports.fromSystem=be;exports.gatherEventCommandLocators=Le;exports.getControlChars=Ue;exports.getNoteValue=xe;exports.handleGroupComment=_;exports.handleGroupMessage=I;exports.handleGroupScript=v;exports.handleGroupScrollingText=M;exports.handlerDispatch=ne;exports.isBodyParams=g;exports.isChoiceHelp=re;exports.isHeadCommand=Oe;exports.isMessageHeader=q;exports.isValidEvent=se;exports.joinCommandBodies=T;exports.locateEventCommands=oe;exports.makeRegex=d;exports.mapTextCommand=Re;exports.normalizedCommands=C;exports.normalizedCommonEvents=Be;exports.normalizedMapData=De;exports.normalizedTroops=ke;exports.pickCommandParamNumber=$e;exports.pickCommandParamString=Ke;exports.pickCommands=l;exports.pickComments=b;exports.pickHead=S;exports.pickMessageHeader=U;exports.pickMessageWithHead=K;exports.pickPropertys=de;exports.pickScripts=j;exports.pickScrollText=Z;exports.pickScrollTextHeader=J;exports.pickString=qe;exports.readNote=Pe;exports.readNoteEx=G;exports.readNoteObject=Ve;exports.replaceCommonEvents=me;exports.replaceEventCommands=R;exports.replaceMapEvents=ie;exports.replaceNote=We;exports.replacePages=H;exports.replaceTroops=ue;exports.setNoteValue=Fe;
//# sourceMappingURL=rpg-data-tools.cjs.js.map
