"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("@sigureya/rpgtypes"),o=()=>[0,0,0,0,0,0,0,0],ce=e=>({id:0,name:"",nickname:"",profile:"",note:"",classId:0,initialLevel:1,maxLevel:99,characterIndex:0,characterName:"",faceIndex:0,faceName:"",battlerName:"",traits:[],equips:[],...e}),ie=e=>({battlerHue:0,id:0,name:"",note:"",battlerName:"",traits:[],params:o(),exp:0,gold:0,dropItems:[],actions:[],...e}),oe=e=>({price:0,id:0,name:"",note:"",iconIndex:0,description:"",etypeId:0,params:o(),traits:[],...e}),le=e=>({price:0,id:0,name:"",note:"",iconIndex:0,description:"",etypeId:0,wtypeId:0,params:o(),traits:[],damage:u(),...e}),me=e=>({id:0,name:"",note:"",traits:[],learnings:[],params:o(),expParams:[],...e}),u=e=>({type:0,elementId:0,formula:"0",variance:20,critical:!1,...e}),de=e=>({id:0,name:"",iconIndex:0,description:"",note:"",price:0,consumable:!1,scope:0,occasion:0,speed:0,successRate:100,repeats:1,tpGain:0,hitType:0,animationId:0,damage:u(),effects:[],...e}),ue=e=>({animationId:0,damage:u(),description:"",hitType:0,iconIndex:0,id:0,message1:"",message2:"",mpCost:0,name:"",note:"",occasion:0,repeats:1,requiredWtypeId1:0,requiredWtypeId2:0,scope:0,speed:0,stypeId:0,successRate:100,tpCost:0,tpGain:0,effects:[],messageType:0,...e}),pe=e=>({id:0,name:"",iconIndex:0,restriction:0,priority:50,motion:0,overlay:0,removeAtBattleEnd:!1,removeByRestriction:!1,autoRemovalTiming:0,minTurns:1,maxTurns:1,removeByDamage:!1,chanceByDamage:100,removeByWalking:!1,stepsToRemove:100,message1:"",message2:"",message3:"",message4:"",traits:[],note:"",...e}),he=e=>({autoplayBgm:!0,autoplayBgs:!1,battleback1Name:"",battleback2Name:"",data:[],disableDashing:!1,displayName:"",encounterList:[],events:[],height:0,note:"",width:0,x:0,y:0,parallaxName:"",parallaxLoopX:!1,parallaxLoopY:!1,parallaxShow:!1,parallaxSx:0,parallaxSy:0,...e}),ge=e=>({id:0,name:"",note:"",x:0,y:0,pages:[A()],...e}),x=e=>({actorId:0,actorValid:!1,itemId:0,itemValid:!1,selfSwitchCh:"",selfSwitchValid:!1,switch1Id:0,switch1Valid:!1,switch2Id:0,switch2Valid:!1,variableId:0,variableValid:!1,variableValue:0,...e}),M=e=>({characterIndex:0,characterName:"",direction:6,pattern:0,tileId:0,...e}),A=e=>({conditions:x(),image:M(),moveRoute:{list:[],repeat:!1,wait:!1,skippable:!1},directionFix:!1,moveFrequency:0,list:[],...e}),r=()=>({name:"",pan:0,pitch:100,volume:90}),fe=(e={})=>({local:e.local??"",gameTitle:e.gameTitle??"",currencyUnit:e.currencyUnit??"",title1Name:e.title1Name??"",terms:e.terms??y(),title2Name:e.title2Name??"",optAutosave:e.optAutosave??!1,attackMotions:e.attackMotions??[],startMapId:e.startMapId??0,startX:e.startX??0,startY:e.startY??0,switches:e.switches??[],windowTone:e.windowTone??[0,0,0,0],editMapId:e.editMapId??0,testTroopId:e.testTroopId??0,testBattlers:e.testBattlers??[],versionId:e.versionId??0,advanced:e.advanced??G(),armorTypes:e.armorTypes??[],elements:e.elements??[],variables:e.variables??[],equipTypes:e.equipTypes??[],sounds:e.sounds??O(),titleBgm:e.titleBgm??r(),gameoverMe:e.gameoverMe??r(),battleBgm:e.battleBgm??r(),defeatMe:e.defeatMe??r(),victoryMe:e.victoryMe??r(),battleback1Name:e.battleback1Name??"",battleback2Name:e.battleback2Name??"",battlerName:e.battlerName??"",weaponTypes:e.weaponTypes??[],skillTypes:e.skillTypes??[],optDisplayTp:e.optDisplayTp??!1,optDrawTitle:e.optDrawTitle??!1,optExtraExp:e.optExtraExp??!1,optFloorDeath:e.optFloorDeath??!1,optFollowers:e.optFollowers??!1,optKeyItemsNumber:e.optKeyItemsNumber??!1,optSideView:e.optSideView??!1,optSlipDeath:e.optSlipDeath??!1,optTransparent:e.optTransparent??!1,boat:e.boat??d(),ship:e.ship??d(),airship:e.airship??d(),tileSize:e.tileSize??0}),y=(e={})=>({messages:D(e.messages??{}),commands:w(e.commands??{}),params:k(e.params??{}),basic:R(e.basic??{})}),R=(e={})=>[e.level??"",e.levelA??"",e.hp??"",e.hpA??"",e.mp??"",e.mpA??"",e.tp??"",e.tpA??"",e.experience??"",e.exp??""],k=(e={})=>[e.mhp??"",e.mmp??"",e.atk??"",e.def??"",e.mat??"",e.mdf??"",e.agi??"",e.luk??"",e.hit??"",e.eva??""],w=(e={})=>[e.fight??"",e.escape??"",e.attack??"",e.guard??"",e.item??"",e.skill??"",e.equip??"",e.status??"",e.formation??"",e.save??"",e.gameEnd??"",e.options??"",e.weapon??"",e.armor??"",e.keyItem??"",e.equip2??"",e.optimize??"",e.clear??"",e.newGame??"",e.continue_??"",e.notUsed20??"",e.toTitle??"",e.cancel??"",e.notUsed23??"",e.buy??"",e.sell??""],D=(e={})=>({alwaysDash:e.alwaysDash??"",commandRemember:e.commandRemember??"",touchUI:e.touchUI??"",bgmVolume:e.bgmVolume??"",bgsVolume:e.bgsVolume??"",meVolume:e.meVolume??"",seVolume:e.seVolume??"",possession:e.possession??"",expTotal:e.expTotal??"",expNext:e.expNext??"",saveMessage:e.saveMessage??"",loadMessage:e.loadMessage??"",file:e.file??"",autosave:e.autosave??"",partyName:e.partyName??"",emerge:e.emerge??"",preemptive:e.preemptive??"",surprise:e.surprise??"",escapeStart:e.escapeStart??"",escapeFailure:e.escapeFailure??"",victory:e.victory??"",defeat:e.defeat??"",obtainExp:e.obtainExp??"",obtainGold:e.obtainGold??"",obtainItem:e.obtainItem??"",levelUp:e.levelUp??"",obtainSkill:e.obtainSkill??"",useItem:e.useItem??"",criticalToEnemy:e.criticalToEnemy??"",criticalToActor:e.criticalToActor??"",actorDamage:e.actorDamage??"",actorRecovery:e.actorRecovery??"",actorGain:e.actorGain??"",actorLoss:e.actorLoss??"",actorDrain:e.actorDrain??"",actorNoDamage:e.actorNoDamage??"",actorNoHit:e.actorNoHit??"",enemyDamage:e.enemyDamage??"",enemyRecovery:e.enemyRecovery??"",enemyGain:e.enemyGain??"",enemyLoss:e.enemyLoss??"",enemyDrain:e.enemyDrain??"",enemyNoDamage:e.enemyNoDamage??"",enemyNoHit:e.enemyNoHit??"",evasion:e.evasion??"",magicEvasion:e.magicEvasion??"",magicReflection:e.magicReflection??"",counterAttack:e.counterAttack??"",substitute:e.substitute??"",buffAdd:e.buffAdd??"",debuffAdd:e.debuffAdd??"",buffRemove:e.buffRemove??"",actionFailure:e.actionFailure??""}),G=(e={})=>({gameId:e.gameId??0,screenWidth:e.screenWidth??0,screenHeight:e.screenHeight??0,uiAreaWidth:e.uiAreaWidth??0,uiAreaHeight:e.uiAreaHeight??0,windowOpacity:e.windowOpacity??0,screenScale:e.screenScale??0,numberFontFilename:e.numberFontFilename??"",mainFontFilename:e.mainFontFilename??"",fallbackFonts:e.fallbackFonts??"",fontSize:e.fontSize??0}),d=(e={})=>({bgm:e.bgm??r(),characterIndex:e.characterIndex??0,characterName:e.characterName??"",startMapId:e.startMapId??0,startX:e.startX??0,startY:e.startY??0}),O=(e={})=>[e.cursor??r(),e.ok??r(),e.cancel??r(),e.buzzer??r(),e.equip??r(),e.save??r(),e.load??r(),e.battleStart??r(),e.escape??r(),e.enemyAttack??r(),e.enemyDamage??r(),e.enemyCollapse??r(),e.bossCollapse1??r(),e.bossCollapse2??r(),e.actorDamage??r(),e.actorCollapse??r(),e.playRecovery??r(),e.playMiss??r(),e.playEvasion??r(),e.playMagicEvasion??r(),e.playReflection??r(),e.shop??r(),e.useItem??r(),e.useSkill??r()],p=(e,a)=>a?e===a.code:!1,_="MessageHeader invalid command",Ee="Script invalid command",H="Invalid Head",h=e=>typeof e[0]=="string"&&e.length===1,Se=(e,a)=>a?e===a.code&&h(a.parameters):!1,l=(e,a,t)=>{const n=[];for(let s=t;s<a.length;s++){const i=a[s];if(p(e,i)&&h(i.parameters))n.push({code:e,indent:i.indent,parameters:[i.parameters[0]]});else break}return n},f=(e,a,t)=>{const n=e[a];if(n&&p(t,n)&&h(n.parameters))return{code:t,indent:n.indent,parameters:[n.parameters[0]]};throw new Error(H,{cause:n})},B=(e,a)=>({head:f(e,a,c.COMMENT),bodys:l(c.COMMENT_BODY,e,a+1)}),V=(e,a)=>({head:f(e,a,c.SCRIPT_EVAL),bodys:l(c.SCRIPT_EVAL_BODY,e,a+1)}),L=(e,a)=>{const t=e[a];if(t&&P(t))return t;throw new Error(_,{cause:t})},P=e=>!e||e.code!==c.SHOW_MESSAGE||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",F=(e,a)=>({head:L(e,a),bodys:l(c.SHOW_MESSAGE_BODY,e,a+1)}),W="ScrollTextHeader invalid command",q=(e,a)=>{const t=e[a];if(p(c.SHOW_SCROLLING_TEXT,t))return t;const n={headCode:c.SHOW_SCROLLING_TEXT,bodyCode:c.SHOW_SCROLLING_TEXT_BODY,index:a};throw new Error(W,{cause:n})},z=(e,a)=>({head:q(e,a),bodys:l(c.SHOW_SCROLLING_TEXT_BODY,e,a+1)}),X=(e,a=`
`)=>e.map(t=>t.parameters[0]).join(a);class E{constructor(a,t){this.header=a,this.bodies=t}getBodyText(a=`
`){return X(this.getExpandedBodies(),a)}joinCommandBodies(){return this.getExpandedBodies()}}class S extends E{constructor(a,t,n){super(t,n),this.bodyCode=a}getExpandedBodies(){return this.bodies}normalizedCommands(){const a={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};if(this.bodies.length===0)return[a];const t={code:this.bodyCode,indent:0,parameters:[this.getBodyText()]};return[a,t]}}class v extends E{constructor(a,t){super(a,t)}getExpandedBodies(){return[this.header,...this.bodies]}normalizedCommands(){const a=this.getBodyText();return[{code:this.header.code,parameters:[a],indent:this.header.indent}]}}const Y=(e,a=[])=>new S(401,e,a),U=(e,a=[])=>new S(405,e,a),j=(e,a=[])=>new v(e,a),$=(e,a=[])=>new v(e,a),K=(e,a,t)=>{const n=F(e,a),s=Y(n.head,n.bodys);return t(s)},Z=(e,a,t)=>{const n=z(e,a),s=U(n.head,n.bodys);return t(s)},J=(e,a,t)=>{const n=B(e,a),s=j(n.head,n.bodys);return t(s)},Q=(e,a,t)=>{const n=V(e,a),s=$(n.head,n.bodys);return t(s)},ee=(e,a,t)=>{const n=e[a];switch(n.code){case c.SHOW_MESSAGE:return K(e,a,t.showMessage);case c.SHOW_SCROLLING_TEXT:return Z(e,a,t.showScrollingText);case c.COMMENT:return J(e,a,t.comment);case c.SCRIPT_EVAL:return Q(e,a,t.script);case c.SHOW_CHOICES:return t.showChoices(n,a,e);case c.SHOW_CHOICES_ITEM:return t.choiceWhen(n,a,e);case c.CHANGE_NAME:return t.changeName(n,a,e);case c.CHANGE_PROFILE:return t.changeProfile(n,a,e);case c.CHANGE_NICKNAME:return t.changeNickname(n,a,e);default:return t.other(n,a,e)}},ve=(e,a)=>e.map((t,n,s)=>ee(s,n,a)),g=e=>!!e,ae=(e,a,t)=>({command:e,eventId:a,pageIndex:t}),te=(e,a)=>e.pages.map((t,n)=>t.list.map(s=>a(s,e.id,n))),Ce=e=>e.events.filter(g).map(t=>te(t,ae)).flat(2),C=(e,a)=>{const t=a(e.list);return{...e,list:t}},b=(e,a)=>({...e,pages:e.pages.map(t=>C(t,a))}),be=(e,a)=>({...e,events:e.events.map(t=>t?b(t,a):null)}),Te=(e,a)=>[null,...e.filter(g).map(n=>C(n,a))],Ie=(e,a)=>[null,...e.filter(g).map(n=>b(n,a))],T=(e,a)=>`<${e}:${a}>`,m=()=>/<([^<>:]+):([^>]*)>/g,Ne=(e,a)=>I(e.note,(t,n)=>a(t,n,e)),xe=e=>I(e,(a,t)=>[a,t]),I=(e,a)=>{const t=m(),n=[];let s;for(;(s=t.exec(e))!==null;)n.push(a(s[1],s[2]));return n},Me=(e,a)=>e.replace(m(),(t,n,s)=>{const i=a(n,s);return T(n,i)}),Ae=(e,a)=>{const t=m();let n;for(;(n=t.exec(e))!==null;)if(n[1]===a)return n[2]},ye=(e,a,t)=>{const n=m();return e.replace(n,(s,i)=>i===a?T(i,t):s)},Re=e=>`code:${e}`,ke="N",we="V",N=(e,a)=>`\\${e}[${a}]`,ne=e=>N(ke,e.id),De=e=>e.map(a=>({controlChar:ne(a),text:a.name})),Ge=e=>e.variables.map((a,t)=>({text:a||"",controlChar:N(we,t)})).filter(a=>a.text!==""),Oe=new Set(["px","py","x","y","v","n","p","g","c","i","fs"]),_e=(e,a=Oe)=>{const t=/\\([A-Za-z]+)\[(\d+)]/g,n=[];let s;for(;(s=t.exec(e))!==null;){const i=s[1].toLowerCase(),se=parseInt(s[2],10);a.has(i)&&n.push({char:s[1],id:se})}return n},re=(e,a,t)=>a.map(n=>t(n,e[n],e)),He=(e,a,t)=>re(e,a,t),Be=(e,a)=>({code:e.code,paramIndex:a,value:e.parameters[a]}),Ve=(e,a)=>({code:e.code,paramIndex:a,value:e.parameters[a]});exports.BaseEventCommandGroup=E;exports.CombinedEventCommandGroup=v;exports.ERROR_COMMAND_MESSAGE=_;exports.ERROR_COMMAND_SCRIPT=Ee;exports.ERROR_INVALID_HEAD=H;exports.ERROR_MESSAGE=W;exports.SimpleEventCommandGroup=S;exports.codeInfoText=Re;exports.codeTest=p;exports.constructActor=ce;exports.constructArmor=oe;exports.constructClass=me;exports.constructDamage=u;exports.constructEnemy=ie;exports.constructItem=de;exports.constructParamArray=o;exports.constructSkill=ue;exports.constructState=pe;exports.constructWeapon=le;exports.createAdvanced=G;exports.createAudio=r;exports.createBasicTerms=R;exports.createCommandsArray=w;exports.createCommentGroup=j;exports.createCondtion=x;exports.createControlCharFormat=N;exports.createEventPage=A;exports.createMap=he;exports.createMapEvent=ge;exports.createMapEventContext=ae;exports.createMapEventImage=M;exports.createMessageGroup=Y;exports.createMessages=D;exports.createNoteEntity=T;exports.createParamNamesArray=k;exports.createScriptGroup=$;exports.createScrlloingTextGroup=U;exports.createSystemData=fe;exports.createSystemSoundsArray=O;exports.createTerms=y;exports.createVehicle=d;exports.fromActor=ne;exports.fromActors=De;exports.fromSystem=Ge;exports.gatherEventCommandLocators=Ce;exports.getControlChars=_e;exports.getNoteValue=Ae;exports.handleGroupComment=J;exports.handleGroupMessage=K;exports.handleGroupScript=Q;exports.handleGroupScrollingText=Z;exports.handlerDispatch=ee;exports.isBodyParams=h;exports.isHeadCommand=Se;exports.isMessageHeader=P;exports.isValidEvent=g;exports.joinCommandBodies=X;exports.locateEventCommands=te;exports.makeRegex=m;exports.mapTextCommand=ve;exports.pickCommandParamNumber=Ve;exports.pickCommandParamString=Be;exports.pickCommands=l;exports.pickComments=B;exports.pickHead=f;exports.pickMessageHeader=L;exports.pickMessageWithHead=F;exports.pickPropertys=re;exports.pickScripts=V;exports.pickScrollText=z;exports.pickScrollTextHeader=q;exports.pickString=He;exports.readNote=xe;exports.readNoteEx=I;exports.readNoteObject=Ne;exports.replaceCommonEvents=Te;exports.replaceEventCommands=C;exports.replaceMapEvents=be;exports.replaceNote=Me;exports.replacePages=b;exports.replaceTroops=Ie;exports.setNoteValue=ye;
//# sourceMappingURL=rpg-data-tools.cjs.js.map
